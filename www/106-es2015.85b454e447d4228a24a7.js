(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{VEWP:function(t,o,e){"use strict";e.d(o,"a",function(){return g});var s=e("mrSG"),i=e("fXoL"),n=e("4lGw"),c=e("V0Fi"),r=e("ZyuK"),a=e("ZF3V"),p=e("EIUR"),l=e("DFXC"),u=e("zngb"),h=e("Q0Ba"),m=e("Isd1"),f=e("L0og");const O=["complexLookupComponentObj"];let g=(()=>{class t extends a.a{constructor(t,o,e,s){super(t,o),this.commonService=t,this.omniPull=e,this.accountsService=s,this.options={fromTo:"",requestObject:null},this.complexLookupOptions={requestObject:null,notFoundMessage:"no_valid_account_found_key",multiple:!!this.options.multiple&&this.options.multiple},this.onAccountChange=new i.o,this.onAccountDeleted=new i.o,this.labelValuesMap=new Map,this.psCurrency=new p.a,this.labelOptions={},this.allType=!1}ngOnInit(){this.loadAccounts(null),this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.title="title_key",this.complexLookupOptions.subTitle="sub_title_key",this.complexLookupOptions.labelsValueMap=this.labelValuesMap,this.allType=!!this.options.allType&&this.options.allType,this.commonProv.copyObject(this.complexLookupOptions,this.options,!1),this.complexLookupOptions.requestObject=this.options.requestObject}ngOnChanges(t){this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.placeHolder=this.options.placeHolder}loadAccounts(t){return Object(s.b)(this,void 0,void 0,function*(){if(null!=t&&(this.options=t),this.options.listOfAccounts=[],void 0===this.options.fromTo||""===this.options.fromTo)return void this.logger.error("lookup_from_to_missing_key");const o=this.commonService.session.getValueOf(u.a.USERINFO),e=this.prepareRequestData(o);this.returnAccountList(e)})}returnAccountList(t){return Object(s.b)(this,void 0,void 0,function*(){const o=this.commonProv.session.getValueOf(c.a.PERSONALIZATION_CO);this.complexLookupOptions.listOfOptions=void 0;const e=yield this.omniPull.returnAccounts(t).catch(t=>{this.complexLookupOptions.listOfOptions=[],this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",t)});if(e&&e.gridModel.length>0){if(this.allType){t.accountType="F",t.permittedGls="F";const o=yield this.omniPull.returnAccounts(t).catch(t=>{this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",t)});o&&o.gridModel.length>0&&(e.gridModel=[...e.gridModel,...o.gridModel])}if(this.options.listOfAccounts=e.gridModel,this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(t=>t.accountNumber!==this.options.accountNumber)),this.options.currency&&""!==this.options.currency&&(this.complexLookupOptions.listOfOptions=this.fetchAccountBasedOnCurrency(this.options.currency),this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(t=>t.accountNumber!==this.options.accountNumber))),null!=this.options.accountNumber&&""!==this.options.accountNumber||(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts),this.complexLookupOptions.listOfOptions=this.populateCustomAccounts(this.complexLookupOptions.listOfOptions),this.complexLookupOptions.listOfOptions.map((t,o)=>t.rowIndex=o),this.allAccounts=Object.assign([],this.complexLookupOptions.listOfOptions),null==this.complexLookupOptions.selectedItems&&(this.complexLookupOptions.selectedItems=[]),this.complexLookupOptions.multiple&&this.handleMultipleSelection(),!this.options.requestObject[this.options.fcName]&&(this.options.defaultByPersonalizedAcc=null==this.options.defaultByPersonalizedAcc||this.options.defaultByPersonalizedAcc,"from"===this.options.fromTo&&this.options.defaultByPersonalizedAcc)){let t="QR"===this.options.purpose?null==o?void 0:o.defaultQrPaymentAccKey:null==o?void 0:o.defaultTransferAccKey;this.complexLookupOptions.listOfOptions.map(o=>{o.personalizeKey&&o.personalizeKey===t&&(this.common.setValInsideNestedObj(this.options.fcName,o.lookupKey,this.options.requestObject),this.common.setValInsideNestedObj(this.options.fcName+"_lookupKey",o.lookupKey,this.options.requestObject))})}}else this.listOfAccounts=[],this.complexLookupOptions.listOfOptions=[]})}populateCustomAccounts(t){const o=[];for(const e of t){const t={briefNameEnglish:e.briefNameEnglish,cifShortNameEnglish:e.cifShortNameEnglish,accountNumber:e.accountNumber,balance:this.psCurrency.transform(null==e.balance?"0.0":e.balance,e.currencyDecimalPoints)+" "+(e.currencyBriefName||e.currencyBriefNameEnglish),availableBalance:this.psCurrency.transform(null==e.availableBalance?"0.0":e.availableBalance,e.currencyDecimalPoints)+" "+(e.currencyBriefName||e.currencyBriefNameEnglish),currencyBriefName:e.currencyBriefName||e.currencyBriefNameEnglish,currencyBriefNameEnglish:e.currencyBriefNameEnglish,currency:e.currency,accountTypeDesc:e.accountTypeDesc,additionalRef:e.additionalRef,ibanAccNo:e.ibanAccNo,accGl:e.accGl,serialNo:e.serialNo,branch:e.branch,cif:e.cif,formattedAccount:this.accountsService.returnFormattedAccount(e).formattedAccount,personalizeKey:e.personalizeKey,nickName:e.nickName,briefName:e.briefName,lookupKey:e.additionalRef,branchDescription:e.branchDescription?e.branchDescription:"",generalLedgerBriefNameEng:e.generalLedgerBriefNameEng?e.generalLedgerBriefNameEng:"",previewProperty:"accountNumber",status:e.statusDescription,statusCode:e.status,accountFormat:this.accountsService.returnFormattedAccount(e).accountFormat};this.options.multiple&&(t.excludeType=e.excludeType),o.push(t)}return o}prepareRequestData(t){let o={};if(t&&t.omniUserVO&&(o={userCifNo:t.omniUserVO.CIF_NO,type:"A"}),null!=this.options.queryParams&&void 0!==this.options.queryParams&&""!==this.options.queryParams&&(o={commonParametersList:this.options.queryParams}),null!=this.options.accountType&&void 0!==this.options.accountType&&""!==this.options.accountType&&(o.accountType=this.options.accountType),null!=this.options.glTypes&&void 0!==this.options.glTypes&&""!==this.options.glTypes&&(o.permittedGls=this.options.glTypes),null!=this.options.fromTo&&""!==this.options.fromTo&&(o.fromTo=this.options.fromTo),null!=this.options.endUserId&&""!==this.options.endUserId&&(o.endUserId=this.options.endUserId),null!=this.options.fromCurrency?o.fromCurrency=this.options.fromCurrency:null!=this.options.toCurrency&&(o.toCurrency=this.options.toCurrency),null!=this.options.accountAllowedCurrencies&&void 0!==this.options.accountAllowedCurrencies)if("string"==typeof this.options.accountAllowedCurrencies)o.accountAllowedCurrencies=this.options.accountAllowedCurrencies;else{let t="";for(const o in this.options.accountAllowedCurrencies)t+=this.options.accountAllowedCurrencies[o]+",";t=t.slice(0,t.lastIndexOf(",")),o.accountAllowedCurrencies=t}if(null!=this.options.accountAllowedTypes&&void 0!==this.options.accountAllowedTypes)if("string"==typeof this.options.accountAllowedTypes)o.accountAllowedTypes=this.options.accountAllowedTypes;else{let t="";for(const o in this.options.accountAllowedTypes)t+=this.options.accountAllowedTypes[o]+",";t=t.slice(0,t.lastIndexOf(",")),o.accountAllowedTypes=t}return o}fetchAccountBasedOnCurrency(t){return this.options.listOfAccounts}onChange(t){this.logger.log(t)}populateOwnAccountMap(){let t={},o={},e={};t={key:"accountNumber",value:"--- --- --- ---",isEdit:!1},o={key:"currentBalance",value:"0.0",isEdit:!1},e={key:"availableBalance",value:"0.0",isEdit:!1},this.labelValuesMap.set("account_key",t),this.labelValuesMap.set("balance_key",o),this.labelValuesMap.set("available_balance_key",e)}onChangeItem(t){this.onAccountChange.emit(t)}onDeleteItem(t){t&&this.onAccountDeleted.emit(t)}handleMultipleSelection(){const t=this.options.setAllAccountsAsSelecetd?this.complexLookupOptions.listOfOptions:this.options.requestObject[this.options.fcName]?this.complexLookupOptions.listOfOptions.filter(t=>this.options.requestObject[this.options.fcName].some(o=>o.accountNumber==t.accountNumber)):[];this.complexLookupOptions.selectedItems=t.filter(t=>this.options.setAllAccountsAsSelecetd&&(!t.excludeType||!(t.excludeType.includes(c.a.GENERAL_ACCOUNT_EXCLUDE_TYPE)||t.excludeType.includes(c.a.TERM_ACCOUNT_EXCLUDE_TYPE)))||!this.options.setAllAccountsAsSelecetd).map(t=>Object.assign(Object.assign({item:t[t.previewProperty]},t),{itemLookup:t.lookupKey})),this.complexLookupOptions.selectedItems.length>0&&this.complexLookupComponentObj.setSelectedItems(this.complexLookupOptions.selectedItems)}removeAccount(t){t&&void 0!==this.allAccounts&&(this.complexLookupOptions.listOfOptions=this.allAccounts?this.allAccounts.filter(o=>t.accountNumber!=o.accountNumber):[])}reset(){this.complexLookupComponentObj.resetLookUp()}refreshAcounts(t){this.complexLookupOptions.listOfOptions=Object.assign([],this.allAccounts),this.removeAccount(t)}}return t.\u0275fac=function(o){return new(o||t)(i.Rb(h.a),i.Rb(l.a),i.Rb(r.a),i.Rb(n.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["ps-lookup-own-accounts"]],viewQuery:function(t,o){if(1&t&&i.Wc(O,1),2&t){let t;i.Bc(t=i.gc())&&(o.complexLookupComponentObj=t.first)}},inputs:{options:"options"},outputs:{onAccountChange:"onAccountChange",onAccountDeleted:"onAccountDeleted"},features:[i.Cb,i.Db],decls:3,vars:2,consts:[[1,"ps-complex-own-account"],[3,"id","options","changeItem","onDeleteItem"],["complexLookupComponentObj",""]],template:function(t,o){1&t&&(i.Xb(0,"ps-container-complex",0),i.Xb(1,"ps-complex-lookup",1,2),i.fc("changeItem",function(t){return o.onChangeItem(t)})("onDeleteItem",function(t){return o.onDeleteItem(t)}),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.pc("id",o.id)("options",o.complexLookupOptions))},directives:[m.a,f.a],styles:[""]}),t})()},amOZ:function(t,o,e){"use strict";e.r(o),e.d(o,"ChangeMaturityInstructionsPage",function(){return _});var s=e("3Pt+"),i=e("OVQh"),n=e("fOh1"),c=e("ZyuK"),r=e("f42Q"),a=e("DFXC"),p=e("zngb"),l=e("woXy"),u=e("Q0Ba"),h=e("gKqT"),m=e("EIUR"),f=e("fXoL"),O=e("ofXK"),g=e("kRg/"),y=e("sAFK"),d=e("+f2X"),b=e("VEWP"),A=e("KuXP");const P=["maturitrytransferRef"],N=["profitAccountRef"];function v(t,o){if(1&t&&f.Sb(0,"ps-accounts-list",11),2&t){const t=f.ic();f.pc("options",t.accountListOptions)}}function C(t,o){if(1&t){const t=f.Yb();f.Xb(0,"ps-select-toggle",12),f.fc("onPsChange",function(o){return f.Fc(t),f.ic().onChange(o)}),f.Wb()}if(2&t){const t=f.ic();f.pc("id","accOpenFMid")("options",t.mainOptions.toggleOptions)}}function I(t,o){if(1&t){const t=f.Yb();f.Xb(0,"ps-select-toggle",13),f.fc("onPsChange",function(o){return f.Fc(t),f.ic().onProfitChange(o)}),f.Wb()}if(2&t){const t=f.ic();f.pc("id","accprofitFMid")("options",t.mainOptions.toggleProfitOptions)}}let _=(()=>{class t extends h.OmniBasePage{constructor(t,o,e,c,r,a){super(),this.commonProv=t,this.navService=o,this.loggerP=e,this.eventEmitterService=c,this.datePipe=r,this.omniPull=a,this.formGroup=new s.f({}),this.changeMaturityInstructionsVO={},this.stepperOptions={isHorizontalStepper:!0,requestObject:this.changeMaturityInstructionsVO,numberOfSteps:1,namesofSteps:["change_maturity_step1"],group:this.formGroup,submitOptions:{extraParams:{},submitServiceUrl:n.a.serviceUrl.updateMaturityInstructions,group:this.formGroup,preCallFunction:{func(t){return new Promise((t,o)=>{t(this.executionClass.checkProfitAccount())})},executionClass:this,params:[this]},postCallFunction:{func(t){return new Promise((o,e)=>{o(this.executionClass.serviceRes(t))})},params:[this],executionClass:this}}},this.panelOptionsStep1={isExpandable:!0,labelKey:"maturity_instructions_key",iconName:"document",expanded:!0},this.panelOptionsStep2={isExpandable:!0,labelKey:"account_details_key",iconName:"document",expanded:!0},this.psCurrency=new m.a,this.generalLabelValuesMap=new Map,this.generalHeaderMap=new Map,this.termsLabelValuesMap=new Map,this.termsHeaderMap=new Map,this.enableCifBranch=!1,this.enablePeriodicity=!1,this.accountTypesOptions={accountTypesOptions:{allowedAccountType:p.a.AllowedFixedMaturityAccountsTypes,accountCategory:p.a.ACC_TYPE_T,group:this.formGroup,fcName:"accountTypes"},periodicity:{group:this.formGroup,fcName:"periodiCity"},minimumBalance:{group:this.formGroup,fcName:"minBalance"},group:this.formGroup,requestObject:this.changeMaturityInstructionsVO},this.psComplexAmountOptions={currenciesOptions:{labelKey:"currency_key",placeHolder:"currency_key",group:this.formGroup,fcName:"currency"},amountOptions:{labelKey:"opening_balance_key",placeHolder:"enter_opening_balance_key",fcName:"inputAmount",group:this.formGroup,type:"amount",decimalPoints:3}},this.mainOptions={toggleOptions:{labelKey:"renew_key",placeHolder:"renew_key",group:this.formGroup,fcName:"renew",psClass:"toggleColor"},toggleProfitOptions:{labelKey:"Post_Profit_to_Same_Account_key",placeHolder:"Post_Profit_to_Same_Account_key",group:this.formGroup,fcName:"renewWithSame"}},this.accountListOptions={group:this.formGroup,fcName:"account",isEditable:!1,requestObject:this.changeMaturityInstructionsVO},this.maturityTransferOptions={labelKey:"on_maturity_transfer_balance_to_key",placeHolder:"select_on_maturity_transfer_balance_to_key",component:i.a,group:this.formGroup,accountAllowedCurrencies:[],accountAllowedTypes:[],glTypes:"G",fcName:"maturityAccount",accountType:"G",fromTo:"to",requestObject:this.changeMaturityInstructionsVO},this.profitAccOptions={labelKey:"post_profit_to_key",placeHolder:"select_post_profit_to_key",component:i.a,group:this.formGroup,accountAllowedCurrencies:[],accountAllowedTypes:[],glTypes:"G",fcName:"profitAccount",accountType:"G",fromTo:"to",requestObject:this.changeMaturityInstructionsVO}}ngOnInit(){super.init(),this.baseFormGroup=this.formGroup,this.cifInfo=this.commonProv.session.getValueOf(p.a.USERINFO),this.termAccount=this.navService.getAllParams()?this.navService.getAllParams():{},this.commonProv.copyObject(this.changeMaturityInstructionsVO,this.navService.getAllParams()?this.navService.getAllParams().ScreenVO?this.navService.getAllParams().ScreenVO:this.navService.getAllParams():{}),this.accountListOptions.listOfOptions=[],this.accountListOptions.listOfOptions.push(this.changeMaturityInstructionsVO),this.commonProv.copyObject(this.stepperOptions.submitOptions.extraParams,{branch:this.cifInfo.customerInfoCO?this.cifInfo.customerInfoCO.branchCode:""},!1,!0)}ngAfterViewInit(){var t;this.changeMaturityInstructionsVO.fromAccount=Object.assign({},this.changeMaturityInstructionsVO),setTimeout(()=>{this.changeMaturityInstructionsVO[this.accountTypesOptions.accountTypesOptions.fcName]=this.changeMaturityInstructionsVO.accGl,this.changeMaturityInstructionsVO[this.psComplexAmountOptions.currenciesOptions.fcName]=this.changeMaturityInstructionsVO.currency},300),(null===(t=this.navService.getAllParams())||void 0===t?void 0:t.MaturityInfo)&&(this.commonProv.copyObject(this.changeMaturityInstructionsVO,this.navService.getAllParams().MaturityInfo),this.renewAccount=this.changeMaturityInstructionsVO.renew,this.postProfitAccount=!!this.renewAccount&&this.changeMaturityInstructionsVO.renewWithSame,this.setMaturityTogglesValues(),delete this.changeMaturityInstructionsVO.MaturityInfo)}serviceRes(t){this.commonProv.logger.log(t)}onChange(t){var o,e;0==t.newValue?(this.commonProv.applyDynScreenDisplay(p.a.ACTION_TYPE_VISIBLE,[this.profitAccOptions.fcName],0),null===(o=this.profitAccountRef)||void 0===o||o.reset(),this.profitAccOptions=Object.assign({},this.profitAccOptions)):(null===(e=this.maturitrytransferRef)||void 0===e||e.reset(),this.mainOptions.toggleProfitOptions.group.controls[this.mainOptions.toggleProfitOptions.fcName]&&(this.mainOptions.toggleProfitOptions.group.controls[this.mainOptions.toggleProfitOptions.fcName].oldValue=null),this.changeMaturityInstructionsVO[this.mainOptions.toggleProfitOptions.fcName]=!1),this.commonProv.applyDynScreenDisplay(p.a.ACTION_TYPE_VISIBLE,[this.mainOptions.toggleProfitOptions.fcName],0==t.newValue?0:1),this.commonProv.applyDynScreenDisplay(p.a.ACTION_TYPE_VISIBLE,[this.maturityTransferOptions.fcName],0==t.newValue?1:0)}onProfitChange(t){var o;0==t.newValue?this.changeMaturityInstructionsVO[this.mainOptions.toggleOptions.fcName]=!0:null===(o=this.profitAccountRef)||void 0===o||o.reset(),this.commonProv.applyDynScreenDisplay(p.a.ACTION_TYPE_VISIBLE,[this.profitAccOptions.fcName],0==t.newValue?1:0)}setMaturityTogglesValues(){this.changeMaturityInstructionsVO[this.mainOptions.toggleOptions.fcName]=this.renewAccount,this.changeMaturityInstructionsVO[this.mainOptions.toggleProfitOptions.fcName]=this.renewAccount?this.postProfitAccount:void 0}checkProfitAccount(){const t=!0===this.stepperOptions.requestObject[this.mainOptions.toggleOptions.fcName]||"true"===this.stepperOptions.requestObject[this.mainOptions.toggleOptions.fcName],o=!0===this.stepperOptions.requestObject[this.mainOptions.toggleProfitOptions.fcName]||"true"===this.stepperOptions.requestObject[this.mainOptions.toggleProfitOptions.fcName];(t&&o||!t&&!o)&&this.commonProv.setValInsideNestedObj(this.profitAccOptions.fcName,this.termAccount,this.stepperOptions.requestObject)}}return t.\u0275fac=function(o){return new(o||t)(f.Rb(u.a),f.Rb(l.a),f.Rb(a.a),f.Rb(r.a),f.Rb(O.e),f.Rb(c.a))},t.\u0275cmp=f.Lb({type:t,selectors:[["app-change-maturity-instructions"]],viewQuery:function(t,o){if(1&t&&(f.Wc(P,1),f.Wc(N,1)),2&t){let t;f.Bc(t=f.gc())&&(o.maturitrytransferRef=t.first),f.Bc(t=f.gc())&&(o.profitAccountRef=t.first)}},features:[f.Cb],decls:12,vars:8,consts:[[3,"options"],["step1",""],["id","account_details_panel",3,"options"],["id","account_details",3,"options",4,"ngIf"],["id","change_maturity_panel",3,"options"],["class","ps-toggle-acc-open fixed-maturity-account-toggle",3,"id","options","onPsChange",4,"ngIf"],["id","'maturitrytransfer'+ id",3,"options"],["maturitrytransferRef",""],["class","ps-toggle-acc-open-2",3,"id","options","onPsChange",4,"ngIf"],["id","' profitAccount'+ id",3,"options"],["profitAccountRef",""],["id","account_details",3,"options"],[1,"ps-toggle-acc-open","fixed-maturity-account-toggle",3,"id","options","onPsChange"],[1,"ps-toggle-acc-open-2",3,"id","options","onPsChange"]],template:function(t,o){1&t&&(f.Xb(0,"ps-template-stepper",0),f.Xb(1,"ps-form-step",1),f.Xb(2,"ps-container-panel",2),f.Pc(3,v,1,1,"ps-accounts-list",3),f.Wb(),f.Xb(4,"ps-container-panel",4),f.Pc(5,C,1,2,"ps-select-toggle",5),f.Sb(6,"ps-lookup-own-accounts",6,7),f.Pc(8,I,1,2,"ps-select-toggle",8),f.Xb(9,"div"),f.Sb(10,"ps-lookup-own-accounts",9,10),f.Wb(),f.Wb(),f.Wb(),f.Wb()),2&t&&(f.pc("options",o.stepperOptions),f.Fb(2),f.pc("options",o.panelOptionsStep2),f.Fb(1),f.pc("ngIf",(null==o.accountListOptions||null==o.accountListOptions.listOfOptions?null:o.accountListOptions.listOfOptions.length)>0),f.Fb(1),f.pc("options",o.panelOptionsStep1),f.Fb(1),f.pc("ngIf",void 0!==o.renewAccount),f.Fb(1),f.pc("options",o.maturityTransferOptions),f.Fb(2),f.pc("ngIf",void 0!==o.postProfitAccount),f.Fb(2),f.pc("options",o.profitAccOptions))},directives:[g.a,y.a,d.a,O.o,b.a,i.a,A.a],styles:[""]}),t})()}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[19,339,340,341,342,343,344,345,346,347,348,349],{gKqT:function(e,i,t){"use strict";t.r(i),t.d(i,"OmniBasePage",function(){return d});var s=t("oS+F"),n=t("zngb"),a=t("QZhd"),o=t("woXy"),r=t("qEF5"),c=t("Q0Ba"),l=t("lE2x"),p=t("fXoL");let d=(()=>{class e{constructor(){this.isPageDisabled=!1,this.commonProv=r.a.injectionHandler(c.a),this.navigationServices=r.a.injectionHandler(o.a)}init(){this.currentOperID=a.a.oper_ID,this.customizationMap=this.commonProv.returnOperCustomization();const e=this.navigationServices.getAllParams(),i={};e&&!0===e.readOnlypage?(i.IS_READONLY=1,this.customizationMap&&this.customizationMap.set(n.a.FORM_READONLY,i)):this.customizationMap&&(i.IS_READONLY=0,this.customizationMap.set(n.a.FORM_READONLY,i)),this.screenTranslationOperIds=l.a.MAIN_CONFIG.SCREEN_TRANSLATION_OPER?l.a.MAIN_CONFIG.SCREEN_TRANSLATION_OPER:[],this.screenTranslationOperIds.length>0&&this.screenTranslationOperIds.includes(this.currentOperID)&&this.getScreenTranslations(this.currentOperID)}ngOnInit(){this.init()}ionViewDidEnter(){this.viewDidEnter()}ionViewWillLeave(){this.viewWillLeave()}ionViewWillEnter(){this.viewWillEnter()}viewWillEnter(){}disableForm(e){if(void 0!==e&&this.customizationMap){const i=this.customizationMap.get(n.a.FORM_READONLY);i&&1===i.IS_READONLY&&"DISABLED"!=e.status&&(e.disable(),Object.keys(e.controls).forEach(e=>{this.commonProv.applyDynScreenDisplay(n.a.ACTION_TYPE_READONLY,[e],1)}))}}viewDidEnter(){this.commonProv.checkViewBS.next({value:!0,page:this,didEnter:!0}),this.commonProv.setCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID),this.commonProv.emitCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID,{value:!0,page:this,didEnter:!0}),this.commonProv.dismissLoading(),this.disableForm(this.baseFormGroup),s.a.getAllSessionFcVars(this.baseFormGroup),this.commonProv.setFormGroupByOper(this.baseFormGroup)}viewWillLeave(){this.commonProv.checkViewBS.next({value:!0,page:this,willLeave:!0}),this.commonProv.setCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID),this.commonProv.emitCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID,{value:!0,page:this,willLeave:!0})}ngAfterViewChecked(){this.isPageDisabled||setTimeout(()=>{this.disableForm(this.baseFormGroup),this.isPageDisabled=!0},300)}getScreenTranslations(e){const i=e||2222,t=a.a.activeLanguge?a.a.activeLanguge:"EN";i&&t&&this.commonProv.language.getOperTranslation(t,i)}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=p.Lb({type:e,selectors:[["app-omni-base"]],hostVars:2,hostBindings:function(e,i){2&e&&p.Hb(i.psClass)},decls:0,vars:0,template:function(e,i){},styles:[""]}),e})()},xdyT:function(e,i,t){"use strict";t.d(i,"a",function(){return B});var s=t("mrSG"),n=t("fXoL"),a=t("8Y4A"),o=t("jNcp"),r=t("qEF5"),c=t("lE2x"),l=t("Q0Ba"),p=t("V0Fi"),d=t("TEn/"),h=t("ofXK"),u=t("ilDp"),m=t("5YYs"),g=t("hUjg"),v=t("KVmc");const b=["userVideo"],f=["userVideoPreview"],D=["slider"],I=["userVideoWrapper"],w=["imageReference"];function y(e,i){if(1&e){const e=n.Yb();n.Xb(0,"div",6),n.Xb(1,"div",7),n.fc("click",function(){return n.Fc(e),n.ic(2).dismissModal(!0)}),n.Sb(2,"ps-action-icon",8),n.Wb(),n.Wb()}if(2&e){const e=n.ic(2);n.Fb(2),n.pc("options",e.closeIcon)}}function O(e,i){if(1&e){const e=n.Yb();n.Xb(0,"ps-action-icon",15),n.fc("onClick",function(){return n.Fc(e),n.ic(3).switchCamera()}),n.Wb()}if(2&e){const e=n.ic(3);n.pc("options",e.switchIcon)}}function C(e,i){if(1&e){const e=n.Yb();n.Vb(0),n.Xb(1,"ps-action-image",19,20),n.fc("click",function(){n.Fc(e);const i=n.ic().$implicit;return n.ic(4).checkSelectedMedia(i)}),n.Wb(),n.Ub()}if(2&e){const e=n.ic().$implicit;n.Fb(1),n.pc("options",e)("id",e.dynamicID)}}function P(e,i){if(1&e){const e=n.Yb();n.Vb(0),n.Xb(1,"video",21,22),n.fc("click",function(){n.Fc(e);const i=n.ic().$implicit;return n.ic(4).checkSelectedMedia(i)}),n.Wb(),n.Ub()}}function E(e,i){if(1&e&&(n.Vb(0),n.Pc(1,C,3,2,"ng-container",0),n.Pc(2,P,3,0,"ng-container",0),n.Ub()),2&e){const e=i.$implicit,t=n.ic(4);n.Fb(1),n.pc("ngIf",e.type==t.TYPE_IMAGE),n.Fb(1),n.pc("ngIf",e.type==t.TYPE_VIDEO)}}const F=function(e){return{active:e}};function S(e,i){if(1&e){const e=n.Yb();n.Xb(0,"div",16,17),n.fc("mousedown",function(i){return n.Fc(e),n.ic(3).onMouseDown(i)})("mouseup",function(){return n.Fc(e),n.ic(3).handleMouseEvent(!1)})("mouseleave",function(){return n.Fc(e),n.ic(3).handleMouseEvent(!1)})("mousemove",function(i){return n.Fc(e),n.ic(3).handleOnMove(i)}),n.Pc(2,E,3,2,"ng-container",18),n.Wb()}if(2&e){const e=n.ic(3);n.pc("ngClass",n.sc(2,F,e.onMouseDownFlag)),n.Fb(2),n.pc("ngForOf",e.screenData.visibleImagesOnlyArray)}}function M(e,i){if(1&e&&(n.Vb(0),n.Xb(1,"div",9,10),n.Sb(3,"div"),n.Sb(4,"video",11,12),n.Pc(6,O,1,1,"ps-action-icon",13),n.Wb(),n.Pc(7,S,3,4,"div",14),n.Ub()),2&e){const e=n.ic(2);n.Fb(6),n.pc("ngIf",(null==e.sources?null:e.sources.length)>=2||e.commonP.isNativeMobile()),n.Fb(1),n.pc("ngIf",e.screenData.visibleImagesOnlyArray.length>0)}}const A=function(e,i){return{"col-12":e,"col-6":i}};function R(e,i){if(1&e){const e=n.Yb();n.Xb(0,"ps-action-button",25),n.fc("onClick",function(){return n.Fc(e),n.ic(3).dismissModal()}),n.Wb()}if(2&e){const e=n.ic(3);n.pc("ngClass",n.tc(2,A,!e.screenData.inProgress,e.screenData.inProgress))("options",e.doneOptions)}}function V(e,i){if(1&e){const e=n.Yb();n.Vb(0),n.Xb(1,"ps-action-button",23),n.fc("onClick",function(){n.Fc(e);const i=n.ic(2);return i.screenData.flowWasInitialized?i.captureMedia():i.presentPopup()}),n.Wb(),n.Pc(2,R,1,5,"ps-action-button",24),n.Ub()}if(2&e){const e=n.ic(2);n.Fb(1),n.pc("options",e.options.mediaButton)("ngClass",n.tc(3,A,!e.screenData.inProgress,e.screenData.inProgress)),n.Fb(1),n.pc("ngIf",e.screenData.inProgress)}}function _(e,i){if(1&e){const e=n.Yb();n.Xb(0,"ps-action-button",26),n.fc("onClick",function(){return n.Fc(e),n.ic(2).stopRecording()}),n.Wb()}if(2&e){const e=n.ic(2);n.pc("options",e.stopVideoRecordingLabel)}}const k=function(e,i){return{"flow-initialized":e,"flow-not-initialized":i}};function W(e,i){if(1&e&&(n.Vb(0),n.Pc(1,y,3,1,"div",2),n.Xb(2,"div",3),n.Pc(3,M,8,2,"ng-container",0),n.Xb(4,"div",4),n.Pc(5,V,3,6,"ng-container",0),n.Pc(6,_,1,1,"ps-action-button",5),n.Wb(),n.Wb(),n.Ub()),2&e){const e=n.ic();n.Fb(1),n.pc("ngIf",null==e.options?null:e.options.isAdvanced),n.Fb(1),n.pc("ngClass",n.tc(5,k,e.screenData.flowWasInitialized,!e.screenData.flowWasInitialized)),n.Fb(1),n.pc("ngIf",null==e.options?null:e.options.isAdvanced),n.Fb(2),n.pc("ngIf",!e.videoIsRecording),n.Fb(1),n.pc("ngIf",e.videoIsRecording)}}function T(e,i){if(1&e&&n.Sb(0,"ps-label",29),2&e){const e=n.ic(2);n.pc("id","lbl_"+e.id)("options",e.options.mediaButton)}}function N(e,i){if(1&e&&(n.Vb(0),n.Sb(1,"ps-action-image",30),n.Ub()),2&e){const e=i.$implicit;n.Fb(1),n.pc("options",e)}}function L(e,i){if(1&e&&(n.Xb(0,"div",27),n.Pc(1,T,1,2,"ps-label",28),n.Pc(2,N,2,1,"ng-container",18),n.Wb()),2&e){const e=n.ic();n.Fb(1),n.pc("ngIf",e.options.mediaButton),n.Fb(1),n.pc("ngForOf",e.screenData.visibleImagesOnlyArray)}}let B=(()=>{class e extends o.a{constructor(e,i,t,s,n){super(e,e.logger,i),this.commonP=e,this.elRefC=i,this.cd=t,this.modalController=s,this.cameraPreview=n,this.screenData={micFlag:!1,camFlag:!0,camSide:"user",audioSource:null,videoSource:null,currentStream:null,recorder:null,chunks:[],previewImages:[],flowWasInitialized:!1,inProgress:!1,lastState:!1,lastStateData:{},numberOfImages:c.a.CLIENT_ASSETS_CONFIG.UI_CONFIGURATION.MAX_NUMBER_OF_IMAGES_IN_MEDIA_CAPTURE,currentSelectedImageID:"",currentSelectedImage:null,visibleImagesOnlyArray:[]},this.switchIcon={iconName:"cam-switch"},this.posterIcon={imageName:"camera.svg"},this.onMouseDownFlag=!1,this.onMouseDownDrag=!1,this.sources=[],this.TYPE_VIDEO=p.a.TYPE_VIDEO,this.TYPE_IMAGE=p.a.TYPE_IMAGE,this.closeIcon={iconName:"close",labelOptions:{labelKey:""}},this.videoIsRecording=!1}ngOnInit(){super.init(),this.options&&this.options.group&&(this.doneOptions={labelKey:"done_key",group:this.options.group},this.stopVideoRecordingLabel={labelKey:"stop_recording_key",group:this.options.group},this.options.numberOfImages>0&&(this.screenData.numberOfImages=this.options.numberOfImages))}ngAfterViewInit(){if(this.options&&this.options.isAdvanced){if(r.a.isEmptyObject(this.lastStateData))for(let e=0;e<this.screenData.numberOfImages;e++){let i=this.options.fcName+"_img_"+e+"."+r.a.getCssVariableValue("--ps-preview-image-extension-format");const t={imageName:i,labelOptions:{labelKey:this.options.fcName+"_label_"+e},dynamicID:this.options.fcName+"_"+e,fallBackImageName:"add.svg",type:"image",fileName:i,fileExt:r.a.getCssVariableValue("--ps-preview-image-extension-format"),status:"N",isImage:!0};this.screenData.previewImages.push(t),this.custMode?this.screenData.visibleImagesOnlyArray.push(t):this.checkCustomization(t.dynamicID,t)}else r.a.copyObject(this.screenData,this.lastStateData,!0);this.initFlow()}}checkCustomization(e,i){1==this.commonProv.getElementValidations(e).IS_VISIBLE&&this.screenData.visibleImagesOnlyArray.push(i)}initFlow(){if(this.userVideoRef)if(r.a.isNativeMobile())try{this.nativePreviewInit()}catch(e){this.fallBackInit()}else this.fallBackInit()}fallBackInit(){try{this.initWebRTCFlow()}catch(e){r.a.presentFailureAlert("camera_preview_not_avail_key")}}initWebRTCFlow(){let e=this.userVideoRef.nativeElement;e.muted=!0,e.autoplay=!0,navigator.mediaDevices.getUserMedia(this.getMediaConstaint()).then(i=>Object(s.b)(this,void 0,void 0,function*(){this.isWebRTCAvailable=!0,navigator.mediaDevices.enumerateDevices().then(e=>{const i=e.filter(e=>"videoinput"===e.kind);this.sources=[...i]}),this.screenData.currentStream=i,e&&(e.srcObject=null),e.srcObject=i,yield e.play(),this.screenData.flowWasInitialized=!0,this.checkSelectedMedia(this.screenData.visibleImagesOnlyArray[0])})).catch(e=>{this.logger.log(e),this.nativePreviewInit()})}nativePreviewInit(){setTimeout(()=>{if(this.userVideoWrapper&&this.userVideoWrapper.nativeElement){const e=this.userVideoWrapper.nativeElement.getBoundingClientRect();let i=getComputedStyle(this.userVideoWrapper.nativeElement)["padding-left"],t=getComputedStyle(this.userVideoWrapper.nativeElement)["padding-right"],s=getComputedStyle(this.userVideoWrapper.nativeElement)["padding-top"],n=getComputedStyle(this.userVideoWrapper.nativeElement)["padding-bottom"],a=0,o=0;null!=i&&""!=i&&(a+=parseFloat(i)),null!=t&&""!=t&&(a+=parseFloat(t)),null!=s&&""!=s&&(o+=parseFloat(s)),null!=n&&""!=n&&(o+=parseFloat(n));const r={x:e.x+a,y:e.y+o,width:e.width-2*a,height:e.height-2*o,camera:"rear",tapPhoto:!0,previewDrag:!1,toBack:!1,alpha:1};this.cameraPreview.stopCamera().then(()=>{this.cameraPreview.startCamera(r).then(e=>{this.isWebRTCAvailable=!1}).catch(e=>{this.logger.log(e)})}).catch(e=>{this.logger.log(e),this.cameraPreview.startCamera(r).then(e=>{this.isWebRTCAvailable=!1}).catch(e=>{this.logger.log(e)})})}else this.nativePreviewInit()},500)}getMediaConstaint(){return{video:!!this.screenData.camFlag&&{facingMode:this.screenData.camSide,frameRate:{ideal:10,min:5},noiseSuppression:!0},audio:!!this.screenData.micFlag&&{deviceId:this.screenData.audioSource?this.screenData.audioSource:void 0,echoCancellation:!0}}}startRecording(){return Object(s.b)(this,void 0,void 0,function*(){this.isWebRTCAvailable&&(this.screenData.chunks=[],this.videoIsRecording=!0,this.screenData.recorder=new MediaRecorder(this.screenData.currentStream),this.screenData.recorder.start(),this.screenData.recorder.ondataavailable=e=>{this.screenData.chunks.push(e.data);let i=new Blob(this.screenData.chunks,{type:"video/webm"}),t=URL.createObjectURL(i);this.cd.detectChanges(),this.userVideoPreview.nativeElement.src=t})})}stopRecording(){this.screenData.recorder.stop(),this.screenData.inProgress=!1}goToNext(){const e=this.screenData.visibleImagesOnlyArray.findIndex(e=>e.dynamicID===this.screenData.currentSelectedImageID),i=this.screenData.visibleImagesOnlyArray.length;let t=e;if(t==i-1&&(t=0),-1!=e){let s=!1;for(let n=t;n<this.screenData.visibleImagesOnlyArray.length;n++){const a=this.screenData.visibleImagesOnlyArray[n];if(e!=n&&!a.imageBase64Url&&!a.imageBase64Url&&!s){s=!0,this.checkSelectedMedia(a),this.imagesReference.toArray()[n].nativeElement.scrollIntoView({behavior:"smooth"});break}s||0==t||n!=i-1||(t=0,n=0)}}}captureMedia(){if(this.screenData.inProgress||(this.screenData.inProgress=!0),this.userVideoRef)if(this.screenData.currentSelectedImage.type==this.TYPE_VIDEO)this.isWebRTCAvailable&&this.startRecording();else{let e="",i="jpeg";if(this.isWebRTCAvailable){let t=this.userVideoRef.nativeElement,s=document.createElement("canvas");s.width=t.videoWidth,s.height=t.videoHeight,s.getContext("2d").drawImage(t,0,0,s.width,s.height),e=s.toDataURL(),i="png"}else this.cameraPreview.takePicture({quality:100}).then(i=>{e="data:image/jpeg;base64,"+i},e=>{this.logger.error("error_taking_pic_key")});this.screenData.visibleImagesOnlyArray.forEach(t=>{t.dynamicID===this.screenData.currentSelectedImageID&&(t.imageBase64Url=e,t.file=e.split(",")[1],t.fileExt=i,t.imageUrl=e)}),this.goToNext()}}presentPopup(){return Object(s.b)(this,void 0,void 0,function*(){const i="ps-media-capture-modal",t={};r.a.copyObject(t,this.options,!0),t.isAdvanced=!0,this.modalController.dismiss(null,null,i);const s=yield this.modalController.create({component:e,cssClass:i,componentProps:{options:t,lastStateData:this.screenData&&this.screenData.lastStateData?this.screenData.lastStateData:null},backdropDismiss:!0,animated:!1,id:i});yield s.present(),yield s.onDidDismiss().then(e=>{this.screenData.lastStateData=e.data}).catch(e=>this.common.logger.log(e))})}dismissModal(e){var i;e?(super.resetFileValController(),this.modalController.dismiss()):(super.setFileValController(null===(i=this.screenData)||void 0===i?void 0:i.visibleImagesOnlyArray.filter(e=>e.imageBase64Url)),this.modalController.dismiss(this.screenData,null,"ps-media-capture-modal"))}checkSelectedMedia(e){if(e.type==this.TYPE_VIDEO){const i="ps-confirm-close";this.common.presentPsAlert({cssClass:"user-consent-popup",header:"you_will_be_recorded_key",buttons:[{role:"cancel",options:{labelKey:"cancel_key",psClass:"ps-drafts-report-cancel-button",group:this.options.group},handler:()=>{r.a.dismissAllModals(null,null,i)}},{options:{labelKey:"ok_key",psClass:"ps-drafts-report-cancel-button",group:this.options.group},handler:()=>{r.a.dismissAllModals(null,null,i),this.selectMedia(e)}}]},i)}else this.selectMedia(e)}selectMedia(e){this.screenData.currentSelectedImage=e,this.screenData.visibleImagesOnlyArray.forEach(i=>{i.psClass="",i.dynamicID==e.dynamicID?(i.psClass="ps-selected-image",this.screenData.currentSelectedImageID=e.dynamicID):i.psClass=""})}createDynID(e,i){return e.dynamicID=i,i}handleMouseEvent(e){this.onMouseDownFlag=e,this.onMouseDownDrag=e}onMouseDown(e){e.preventDefault(),this.onMouseDownDrag=!0,this.slider&&(this.startX=e.pageX-this.slider.nativeElement.offsetLeft,this.scrollLeft=this.slider.nativeElement.scrollLeft)}handleOnMove(e){this.onMouseDownDrag&&this.slider&&(this.onMouseDownFlag=!0,e.preventDefault(),this.slider.nativeElement.scrollLeft=this.scrollLeft-2*(e.pageX-this.slider.nativeElement.offsetLeft-this.startX))}switchCamera(){this.isWebRTCAvailable?(this.screenData.currentStream.getTracks().forEach(e=>e.stop()),this.screenData.camSide="environment"==this.screenData.camSide?"user":"environment",this.initFlow()):this.cameraPreview.switchCamera()}ngOnDestroy(){this.cameraPreview.stopCamera()}}return e.\u0275fac=function(i){return new(i||e)(n.Rb(l.a),n.Rb(n.m),n.Rb(n.i),n.Rb(d.N),n.Rb(a.a))},e.\u0275cmp=n.Lb({type:e,selectors:[["ps-complex-media-capture"]],viewQuery:function(e,i){if(1&e&&(n.Wc(b,1),n.Wc(f,1),n.Wc(D,1),n.Wc(I,1),n.Wc(w,1,n.m)),2&e){let e;n.Bc(e=n.gc())&&(i.userVideoRef=e.first),n.Bc(e=n.gc())&&(i.userVideoPreview=e.first),n.Bc(e=n.gc())&&(i.slider=e.first),n.Bc(e=n.gc())&&(i.userVideoWrapper=e.first),n.Bc(e=n.gc())&&(i.imagesReference=e)}},inputs:{options:"options"},features:[n.Cb],decls:2,vars:2,consts:[[4,"ngIf"],["class","ps-custom-component-preview selfie-component","psPreviewEngine","",4,"ngIf"],["class","widget-style",4,"ngIf"],[1,"media-wrapper",3,"ngClass"],[1,"buttons-wrapper"],["class","col-12",3,"options","onClick",4,"ngIf"],[1,"widget-style"],[1,"widget-menu-icon","widget-menu-icon-back",3,"click"],[1,"modal-close-icon",3,"options"],[1,"media-video-wrapper"],["userVideoWrapper",""],["playsinline","","autoplay","",1,"media-video"],["userVideo",""],["class","source-switcher",3,"options","onClick",4,"ngIf"],["class","media-video-wrapper-preview",3,"ngClass","mousedown","mouseup","mouseleave","mousemove",4,"ngIf"],[1,"source-switcher",3,"options","onClick"],[1,"media-video-wrapper-preview",3,"ngClass","mousedown","mouseup","mouseleave","mousemove"],["slider",""],[4,"ngFor","ngForOf"],[1,"media-image-preview",3,"options","id","click"],["imageReference",""],["playsinline","","autoplay","",1,"media-video-preview",3,"click"],["userVideoPreview",""],[3,"options","ngClass","onClick"],[3,"ngClass","options","onClick",4,"ngIf"],[3,"ngClass","options","onClick"],[1,"col-12",3,"options","onClick"],["psPreviewEngine","",1,"ps-custom-component-preview","selfie-component"],["psPreviewLabel","","class","ps-lbl-preview",3,"id","options",4,"ngIf"],["psPreviewLabel","",1,"ps-lbl-preview",3,"id","options"],["psPreviewHTML","",1,"media-image-preview",3,"options"]],template:function(e,i){1&e&&(n.Pc(0,W,7,8,"ng-container",0),n.Pc(1,L,3,2,"div",1)),2&e&&(n.pc("ngIf",(i.visible||i.custMode)&&!i.previewMode),n.Fb(1),n.pc("ngIf",i.previewMode))},directives:[h.o,h.m,u.a,h.n,m.a,g.a,v.a],encapsulation:2}),e})()}}]);
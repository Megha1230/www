{"version":3,"sources":["webpack:///src/app/commonBussinessSRC/psComponents/ps-complex-components/ps-complex-media-capture/ps-complex-media-capture.component.html","webpack:///src/app/commonBussinessSRC/psComponents/ps-complex-components/ps-complex-call-slot/ps-complex-call-slot.component.module.ts","webpack:///src/app/commonBussinessSRC/psComponents/ps-complex-components/ps-complex-call-slot/ps-complex-call-slot.component.ts","webpack:///src/app/commonBussinessSRC/psComponents/ps-complex-components/ps-complex-call-slot/ps-complex-call-slot.component.html","webpack:///src/app/commonBussinessSRC/psComponents/ps-complex-components/ps-complex-media-capture/ps-complex-media-capture.component.module.ts","webpack:///src/app/commonBussinessSRC/psComponents/ps-complex-components/ps-complex-media-capture/ps-complex-media-capture.component.ts"],"names":["PsComplexCallSlotComponentModule","declarations","imports","exports","entryComponents","schemas","colors","red","primary","secondary","blue","yellow","PsComplexCallSlotComponent","commonProv","loggerP","omniPull","cOptions","events","start","Date","end","title","toLocaleTimeString","color","onClick","returnedData","bookSlot","ngOnInit","getDateTimeFormat","group","options","fcName","getParamValOf","result","paramData","lovTypeId","DEFAULT_DATE_TIME_LOV_TYPE_ID","lovCodesInlude","returnLovTypesValues","res","description","dateTimeFormat","data","selector","template","PsComplexMediaCaptureComponentModule","PsComplexMediaCaptureComponent","commonP","elRefC","cd","modalController","cameraPreview","logger","screenData","micFlag","camFlag","camSide","audioSource","videoSource","currentStream","recorder","chunks","previewImages","flowWasInitialized","inProgress","lastState","lastStateData","numberOfImages","CLIENT_ASSETS_CONFIG","UI_CONFIGURATION","MAX_NUMBER_OF_IMAGES_IN_MEDIA_CAPTURE","currentSelectedImageID","currentSelectedImage","visibleImagesOnlyArray","switchIcon","iconName","posterIcon","imageName","onMouseDownFlag","onMouseDownDrag","sources","TYPE_VIDEO","TYPE_IMAGE","closeIcon","labelOptions","labelKey","videoIsRecording","doneOptions","stopVideoRecordingLabel","ngAfterViewInit","isAdvanced","isEmptyObject","copyObject","i","fileName","getCssVariableValue","image","dynamicID","fallBackImageName","type","fileExt","status","isImage","push","custMode","checkCustomization","initFlow","cust","getElementValidations","IS_VISIBLE","userVideoRef","isNativeMobile","nativePreviewInit","err","fallBackInit","initWebRTCFlow","presentFailureAlert","userVideo","nativeElement","muted","autoplay","navigator","mediaDevices","getUserMedia","getMediaConstaint","then","stream","isWebRTCAvailable","enumerateDevices","devices","filtered","filter","device","kind","srcObject","play","checkSelectedMedia","log","setTimeout","userVideoWrapper","wrapperPosition","getBoundingClientRect","paddingLeft","getComputedStyle","paddingRight","paddingTop","paddingBottom","xPadding","yPadding","parseFloat","cameraPreviewOpts","x","y","width","height","camera","tapPhoto","previewDrag","toBack","alpha","stopCamera","startCamera","videoVal","facingMode","frameRate","ideal","min","noiseSuppression","audioVal","deviceId","undefined","echoCancellation","constraints","video","audio","startRecording","MediaRecorder","ondataavailable","event","recordedBlob","Blob","url","URL","createObjectURL","detectChanges","userPreviewVideo","userVideoPreview","src","stopRecording","stop","goToNext","currentIndex","findIndex","item","arrayLength","length","startIndex","wasFound","element","imageBase64Url","reference","imagesReference","toArray","scrollIntoView","behavior","captureMedia","base64URL","ext","canvas","document","createElement","videoWidth","videoHeight","getContext","drawImage","toDataURL","pictureOpts","quality","takePicture","imageData","error","forEach","file","split","imageUrl","presentPopup","id","newOptions","dismiss","create","component","cssClass","componentProps","backdropDismiss","animated","modal","present","onDidDismiss","common","dismissModal","justClose","b","media","modalID","alertController","header","buttons","role","psClass","handler","dismissAllModals","selectMedia","presentPsAlert","createDynID","handleMouseEvent","onMouseDown","e","preventDefault","slider","startX","pageX","offsetLeft","scrollLeft","handleOnMove","walk","switchCamera","tracks","getTracks","track","ngOnDestroy","read"],"mappings":"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","file":"default~pages-bpm-dynamic-page-bpm-dynamic-page-module~pages-dynamic-component-page-loader-dynamic-c~12b2ba92-es5.js","sourcesContent":["export default \"<ng-container *ngIf=\\\"(visible||custMode) && !previewMode\\\">\\n\\n  <div class=\\\"widget-style\\\" *ngIf=\\\"options?.isAdvanced\\\">\\n    <div class=\\\"widget-menu-icon widget-menu-icon-back\\\" (click)=\\\"dismissModal(true)\\\">\\n      <ps-action-icon class=\\\"modal-close-icon\\\" [options]=\\\"closeIcon\\\">\\n      </ps-action-icon>\\n    </div>\\n  </div>\\n\\n  <div class=\\\"media-wrapper\\\"\\n    [ngClass]=\\\"{'flow-initialized':screenData.flowWasInitialized, 'flow-not-initialized':!screenData.flowWasInitialized}\\\">\\n    <ng-container *ngIf=\\\"options?.isAdvanced\\\">\\n      <div class=\\\"media-video-wrapper\\\" #userVideoWrapper>\\n        <div></div>\\n        <video #userVideo class=\\\"media-video\\\" playsinline autoplay></video>\\n        <ps-action-icon class=\\\"source-switcher\\\" [options]=\\\"switchIcon\\\"\\n          *ngIf=\\\"sources?.length>=2 || commonP.isNativeMobile()\\\" (onClick)=\\\"switchCamera()\\\"></ps-action-icon>\\n      </div>\\n\\n\\n      <div #slider class=\\\"media-video-wrapper-preview\\\" *ngIf=\\\"screenData.visibleImagesOnlyArray.length>0\\\"\\n        (mousedown)=\\\"onMouseDown($event)\\\" [ngClass]=\\\"{'active':onMouseDownFlag}\\\" (mouseup)=\\\"handleMouseEvent(false)\\\"\\n        (mouseleave)=\\\"handleMouseEvent(false)\\\" (mousemove)=\\\"handleOnMove($event)\\\">\\n        <ng-container *ngFor=\\\"let prev of screenData.visibleImagesOnlyArray; let i = index\\\">\\n          <ng-container *ngIf=\\\"prev.type == TYPE_IMAGE\\\">\\n            <ps-action-image #imageReference class=\\\"media-image-preview\\\" [options]=\\\"prev\\\"\\n              (click)=\\\"checkSelectedMedia(prev)\\\" [id]=\\\"prev.dynamicID\\\">\\n            </ps-action-image>\\n          </ng-container>\\n\\n          <ng-container *ngIf=\\\"prev.type == TYPE_VIDEO\\\">\\n            <video #userVideoPreview class=\\\"media-video-preview\\\" playsinline autoplay\\n              (click)=\\\"checkSelectedMedia(prev)\\\"></video>\\n          </ng-container>\\n\\n        </ng-container>\\n      </div>\\n    </ng-container>\\n\\n\\n    <div class=\\\"buttons-wrapper\\\">\\n      <ng-container *ngIf=\\\"!videoIsRecording\\\">\\n        <ps-action-button [options]=\\\"options.mediaButton\\\"\\n          (onClick)=\\\"!screenData.flowWasInitialized?presentPopup():captureMedia()\\\"\\n          [ngClass]=\\\"{'col-12': !screenData.inProgress, 'col-6':screenData.inProgress}\\\"></ps-action-button>\\n\\n        <ps-action-button [ngClass]=\\\"{'col-12': !screenData.inProgress, 'col-6':screenData.inProgress}\\\"\\n          *ngIf=\\\"screenData.inProgress\\\" (onClick)=\\\"dismissModal()\\\" [options]=\\\"doneOptions\\\"></ps-action-button>\\n      </ng-container>\\n\\n\\n      <ps-action-button *ngIf=\\\"videoIsRecording\\\" class=\\\"col-12\\\" (onClick)=\\\"stopRecording()\\\"\\n        [options]=\\\"stopVideoRecordingLabel\\\">\\n      </ps-action-button>\\n    </div>\\n\\n  </div>\\n</ng-container>\\n\\n<div *ngIf=\\\"previewMode\\\" class=\\\"ps-custom-component-preview selfie-component\\\" psPreviewEngine>\\n  <ps-label psPreviewLabel *ngIf=\\\"options.mediaButton\\\" [id]=\\\"'lbl_'+ id\\\" [options]=\\\"options.mediaButton\\\"\\n    class=\\\"ps-lbl-preview\\\">\\n  </ps-label>\\n  <ng-container *ngFor=\\\"let prev of screenData.visibleImagesOnlyArray\\\">\\n    <ps-action-image psPreviewHTML class=\\\"media-image-preview\\\" [options]=\\\"prev\\\">\\n\\n    </ps-action-image>\\n  </ng-container>\\n</div>\";","\r\nimport { CUSTOM_ELEMENTS_SCHEMA, NgModule } from '@angular/core';\r\nimport { PsComponentsModule } from 'src/app/commonSRC/psComponents/ps-components.module';\r\nimport { SharedModule } from 'src/app/commonSRC/shared.module';\r\nimport { PsComplexCallSlotComponent } from './ps-complex-call-slot.component';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        PsComplexCallSlotComponent\r\n    ],\r\n    imports: [\r\n        SharedModule,\r\n        PsComponentsModule,\r\n    ],\r\n    exports: [\r\n        PsComplexCallSlotComponent\r\n    ],\r\n    entryComponents: [\r\n        PsComplexCallSlotComponent\r\n    ],\r\n    schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class PsComplexCallSlotComponentModule { }\r\n","import { Component, Input, OnInit } from '@angular/core';\nimport { addDays, addHours, subDays } from 'date-fns';\nimport { CommonBussinessConstant } from 'src/app/commonBussinessSRC/psServices/models/ps-common-bussiness-constant';\nimport { IOmniLovTypeRequest } from 'src/app/commonBussinessSRC/psServices/models/ps-common-bussiness-interfaces';\nimport { OmniPullService } from 'src/app/commonBussinessSRC/psServices/omni-common/omni-pull.service';\nimport { PsBaseFieldComponent } from 'src/app/commonSRC/psComponents/ps-base/ps-base-field/ps-base-field.component';\nimport { LoggerService } from 'src/app/commonSRC/psServices/logger/logger.service';\nimport { IOptionsPsComplexCalendarExposed, IPsCalendarEvent } from 'src/app/commonSRC/psServices/models/ps-common-interface';\nimport { PsCommonService } from '../../../../commonSRC/psServices/ps-common/ps-common.service';\nimport { IOptionsPsComplexCallSlot } from './ps-complex-call-slot.component.interfaces';\n\nconst colors: any = {\n  red: {\n    primary: '#ad2121',\n    secondary: '#FAE3E3',\n  },\n  blue: {\n    primary: '#1e90ff',\n    secondary: '#D1E8FF',\n  },\n  yellow: {\n    primary: '#e3bc08',\n    secondary: '#FDF1BA',\n  },\n};\n\n@Component({\n  selector: 'ps-complex-call-slot',\n  templateUrl: './ps-complex-call-slot.component.html',\n})\n\nexport class PsComplexCallSlotComponent extends PsBaseFieldComponent implements OnInit {\n\n  @Input() options: IOptionsPsComplexCallSlot;\n  dateTimeFormat;\n  constructor(public commonProv: PsCommonService, loggerP: LoggerService, private omniPull: OmniPullService) {\n    super(commonProv, loggerP);\n  }\n  cOptions: IOptionsPsComplexCalendarExposed = {\n    events: [{\n      start: addHours(subDays(new Date(), 1), 1),\n      end: addHours(subDays(new Date(), 1), 2),\n      title: 'Slot From ' + addHours(subDays(new Date(), 1), 1).toLocaleTimeString() + ' to ' + addHours(subDays(new Date(), 1), 2).toLocaleTimeString(),\n      // actions: this.actions,\n      color: colors.red,\n      onClick: (returnedData): any => {\n        this.bookSlot(returnedData);\n      }\n      // allDay: true,\n      // resizable: {\n      //   beforeStart: true,\n      //   afterEnd: true,\n      // },\n      // draggable: true,\n    },\n    {\n      start: addHours(new Date(), 1),\n      end: addHours(new Date(), 2),\n      title: 'Slot From ' + addHours(new Date(), 1).toLocaleTimeString() + ' to ' + addHours(new Date(), 2).toLocaleTimeString(),\n      // actions: this.actions,\n      color: colors.yellow,\n      onClick: (returnedData): any => {\n        this.bookSlot(returnedData);\n      }\n    },\n    {\n      start: addHours(addDays(new Date(), 1), 1),\n      end: addHours(addDays(new Date(), 1), 2),\n      title: 'Slot From ' + addHours(addDays(new Date(), 1), 1).toLocaleTimeString() + ' to ' + addHours(addDays(new Date(), 1), 2).toLocaleTimeString(),\n      color: colors.blue,\n      onClick: (returnedData): any => {\n        this.bookSlot(returnedData);\n      }\n      // allDay: true,\n    },\n    {\n      start: addHours(addDays(new Date(), 2), 1),\n      end: addHours(addDays(new Date(), 2), 2),\n      title: 'Slot From ' + addHours(addDays(new Date(), 2), 1).toLocaleTimeString() + ' to ' + addHours(addDays(new Date(), 2), 2).toLocaleTimeString(),\n      // actions: this.actions,\n      color: colors.yellow,\n      onClick: (returnedData): any => {\n        this.bookSlot(returnedData);\n      }\n      // resizable: {\n      //   beforeStart: true,\n      //   afterEnd: true,\n      // },\n      // draggable: true,\n    }, {\n      start: addHours(new Date(), 4),\n      end: addHours(new Date(), 5),\n      title: 'Slot From ' + addHours(new Date(), 4).toLocaleTimeString() + ' to ' + addHours(new Date(), 5).toLocaleTimeString(),\n      // actions: this.actions,\n      color: colors.yellow,\n      onClick: (returnedData): any => {\n        this.bookSlot(returnedData);\n      }\n      // resizable: {\n      //   beforeStart: true,\n      //   afterEnd: true,\n      // },\n      // draggable: true,\n    },]\n  }\n\n  ngOnInit() {\n    this.getDateTimeFormat();\n    this.cOptions.group = this.options.group;\n    this.cOptions.fcName = this.options.fcName;\n  }\n\n  async getDateTimeFormat() {\n    const result = await this.omniPull.getParamValOf('DefaultDateTimeFormat');\n    if (result) {\n      const paramData: IOmniLovTypeRequest = {\n        lovTypeId: CommonBussinessConstant.DEFAULT_DATE_TIME_LOV_TYPE_ID,\n        lovCodesInlude: result['DefaultDateTimeFormat']\n      };\n      const res = await this.omniPull.returnLovTypesValues(paramData)\n      if (res && res[0] && res[0].description) {\n        this.dateTimeFormat = res[0].description\n      }\n    }\n  }\n\n  async bookSlot(data: IPsCalendarEvent) {\n    return;\n  }\n\n}\n","export default \"<ps-complex-calendar [options]=\\\"cOptions\\\"></ps-complex-calendar>\";","import { CUSTOM_ELEMENTS_SCHEMA, NgModule } from '@angular/core';\r\nimport { RoundProgressModule } from 'angular-svg-round-progressbar';\r\nimport { PsComponentsModule } from 'src/app/commonSRC/psComponents/ps-components.module';\r\nimport { SharedModule } from 'src/app/commonSRC/shared.module';\r\nimport { PsComplexMediaCaptureComponent } from './ps-complex-media-capture.component';\r\n\r\n\r\n@NgModule({\r\n    declarations: [PsComplexMediaCaptureComponent],\r\n    imports: [SharedModule, PsComponentsModule, RoundProgressModule],\r\n    exports: [PsComplexMediaCaptureComponent],\r\n    entryComponents: [PsComplexMediaCaptureComponent],\r\n    schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n})\r\nexport class PsComplexMediaCaptureComponentModule { }\r\n","import { ChangeDetectorRef, Component, ElementRef, Input, QueryList, ViewChild, ViewChildren } from '@angular/core';\nimport { CameraPreview, CameraPreviewOptions, CameraPreviewPictureOptions } from '@ionic-native/camera-preview/ngx';\nimport { ModalController } from '@ionic/angular';\nimport { IOptionsPsActionImageExposed } from 'src/app/commonBussinessSRC/psServices/models/ps-common-bussiness-interfaces';\nimport { PsFieldFileComponent } from 'src/app/commonSRC/psComponents/ps-base/ps-base-field/ps-field-file/ps-field-file.component';\nimport { CommonUtils } from 'src/app/commonSRC/psServices/models/common-utils';\nimport { PsApplicationSettings } from 'src/app/commonSRC/psServices/models/ps-app-settings';\nimport { IOptionsPsActionIconExposed } from 'src/app/commonSRC/psServices/models/ps-common-interface';\nimport { IOptionsPsComplexAlertController } from 'src/app/commonSRC/psTemplates/ps-template-alert-controller/ps-template-alert-controller.template.interfaces';\nimport { PsCommonService } from '../../../../commonSRC/psServices/ps-common/ps-common.service';\nimport { CommonBussinessConstant } from '../../../psServices/models/ps-common-bussiness-constant';\nimport { IOptionsPsComplexMediaCaptureComponent, IOptionsPsMediaCaptureScreenData, PsMediaCapture } from './ps-complex-media-capture.component.interface';\n\n@Component({\n  selector: 'ps-complex-media-capture',\n  templateUrl: './ps-complex-media-capture.component.html',\n})\n\n\nexport class PsComplexMediaCaptureComponent extends PsFieldFileComponent/*  implements AfterViewInit */ {\n\n  @Input() options: IOptionsPsComplexMediaCaptureComponent;\n\n  @ViewChild('userVideo', { static: false }) userVideoRef: ElementRef;\n  @ViewChild('userVideoPreview', { static: false }) userVideoPreview: ElementRef;\n  @ViewChild('slider', { static: false }) slider: ElementRef;\n  @ViewChildren('imageReference', { read: ElementRef }) imagesReference: QueryList<ElementRef>;\n  @ViewChild('userVideoWrapper', { static: false }) userVideoWrapper: ElementRef;\n\n  screenData: IOptionsPsMediaCaptureScreenData = {\n    micFlag: false,\n    camFlag: true,\n    camSide: \"user\",\n    audioSource: null,\n    videoSource: null,\n    currentStream: null,\n    recorder: null,\n    chunks: [],\n    previewImages: [],\n    flowWasInitialized: false,\n    inProgress: false,\n    // showCountdown: false,\n    // initialTime: 3,\n    // currentTimer: 3\n    lastState: false,\n    lastStateData: {},\n    numberOfImages: PsApplicationSettings.CLIENT_ASSETS_CONFIG.UI_CONFIGURATION.MAX_NUMBER_OF_IMAGES_IN_MEDIA_CAPTURE,\n    currentSelectedImageID: '',\n    currentSelectedImage: null,\n    visibleImagesOnlyArray: []\n  };\n\n  lastStateData;\n\n  switchIcon: IOptionsPsActionIconExposed = {\n    iconName: 'cam-switch'\n  };\n\n  posterIcon = {\n    imageName: 'camera.svg'\n  };\n\n  onMouseDownFlag = false;\n  onMouseDownDrag = false;\n  startX;\n  scrollLeft;\n\n  sources = [];\n  isWebRTCAvailable;\n\n  TYPE_VIDEO = CommonBussinessConstant.TYPE_VIDEO;\n  TYPE_IMAGE = CommonBussinessConstant.TYPE_IMAGE;\n\n\n  closeIcon: IOptionsPsActionIconExposed = {\n    iconName: 'close',\n    labelOptions: {\n      labelKey: '',\n    }\n  };\n\n  videoIsRecording = false;\n\n  doneOptions;\n  stopVideoRecordingLabel;\n\n  constructor(public commonP: PsCommonService, private elRefC: ElementRef, private cd: ChangeDetectorRef,\n    private modalController: ModalController, private cameraPreview: CameraPreview) {\n    super(commonP, commonP.logger, elRefC);\n  }\n\n  ngOnInit() {\n    super.init();\n    if (this.options && this.options.group) {\n      this.doneOptions = {\n        labelKey: 'done_key',\n        group: this.options.group\n      };\n\n      this.stopVideoRecordingLabel = {\n        labelKey: 'stop_recording_key',\n        group: this.options.group\n      }\n      if (this.options.numberOfImages > 0) {\n        this.screenData.numberOfImages = this.options.numberOfImages;\n      }\n    }\n  }\n\n  ngAfterViewInit() {\n    if (this.options && this.options.isAdvanced) {\n      if (!CommonUtils.isEmptyObject(this.lastStateData)) {\n        CommonUtils.copyObject(this.screenData, this.lastStateData, true);\n      } else {\n        for (let i = 0; i < this.screenData.numberOfImages; i++) {\n          let fileName = this.options.fcName + '_img_' + i + '.' + CommonUtils.getCssVariableValue('--ps-preview-image-extension-format');\n          const image: PsMediaCapture = {\n            imageName: fileName,\n            labelOptions: {\n              labelKey: this.options.fcName + '_label_' + i\n            },\n            dynamicID: this.options.fcName + '_' + i,\n            fallBackImageName: 'add.svg',\n            type: 'image',\n            fileName: fileName,\n            fileExt: CommonUtils.getCssVariableValue('--ps-preview-image-extension-format'),\n            status: 'N',\n            isImage: true\n          };\n          this.screenData.previewImages.push(image);\n          if (!this.custMode) {\n            this.checkCustomization(image.dynamicID, image);\n          } else {\n            this.screenData.visibleImagesOnlyArray.push(image);\n          }\n        }\n        // const video: PsMediaCapture = {\n        //   imageName: this.options.fcName + '_video_' + '.' + CommonUtils.getCssVariableValue('--ps-preview-image-extension-format'),\n        //   labelOptions: {\n        //     labelKey: this.options.fcName + '_video_label_'\n        //   },\n        //   dynamicID: this.options.fcName + '_video',\n        //   fallBackImageName: 'add.svg',\n        //   type: 'video'\n        // };\n\n        // this.screenData.previewImages.push(video);\n        // if (!this.custMode) {\n        //   this.checkCustomization(video.dynamicID, video);\n        // } else {\n        //   this.screenData.visibleImagesOnlyArray.push(video);\n        // }\n\n      }\n      this.initFlow();\n    }\n  }\n\n  checkCustomization(dynamicID, image) {\n    const cust = this.commonProv.getElementValidations(dynamicID);\n    if (cust.IS_VISIBLE == 1) {\n      this.screenData.visibleImagesOnlyArray.push(image);\n    }\n  }\n\n\n  initFlow() {\n    if (this.userVideoRef) {\n      if (CommonUtils.isNativeMobile()) {\n        try {\n          this.nativePreviewInit();\n        } catch (err) {\n          this.fallBackInit();\n        }\n      } else {\n        this.fallBackInit();\n      }\n    }\n  }\n\n  fallBackInit() {\n    try {\n      this.initWebRTCFlow();\n    } catch (err) {\n      CommonUtils.presentFailureAlert('camera_preview_not_avail_key');\n    }\n  }\n\n  initWebRTCFlow() {\n    let userVideo: HTMLMediaElement = this.userVideoRef.nativeElement;\n    userVideo.muted = true;\n\n    userVideo.autoplay = true;\n    navigator.mediaDevices.getUserMedia(this.getMediaConstaint()).then(async (stream: MediaStream) => {\n      this.isWebRTCAvailable = true;\n      navigator.mediaDevices.enumerateDevices().then(devices => {\n        const filtered = devices.filter(device => device.kind === 'videoinput');\n        this.sources = [...filtered];\n      });\n\n      this.screenData.currentStream = stream;\n      if (userVideo) {\n        userVideo.srcObject = null;\n      }\n      userVideo.srcObject = stream;\n      await userVideo.play();\n      this.screenData.flowWasInitialized = true;\n      this.checkSelectedMedia(this.screenData.visibleImagesOnlyArray[0]);\n    }).catch((err) => {\n      this.logger.log(err);\n      this.nativePreviewInit();\n    });\n  }\n\n  nativePreviewInit() {\n    setTimeout(() => {\n\n      if (this.userVideoWrapper && this.userVideoWrapper.nativeElement) {\n        const wrapperPosition: DOMRect = this.userVideoWrapper.nativeElement.getBoundingClientRect();\n        let paddingLeft: any = getComputedStyle(this.userVideoWrapper.nativeElement)['padding-left'];\n        let paddingRight: any = getComputedStyle(this.userVideoWrapper.nativeElement)['padding-right'];\n        let paddingTop: any = getComputedStyle(this.userVideoWrapper.nativeElement)['padding-top'];\n        let paddingBottom: any = getComputedStyle(this.userVideoWrapper.nativeElement)['padding-bottom'];\n        let xPadding = 0;\n        let yPadding = 0;\n\n        if (paddingLeft != null && paddingLeft != \"\") {\n          xPadding = xPadding + parseFloat(paddingLeft);\n        }\n        if (paddingRight != null && paddingRight != \"\") {\n          xPadding = xPadding + parseFloat(paddingRight);\n        }\n\n\n        if (paddingTop != null && paddingTop != \"\") {\n          yPadding = yPadding + parseFloat(paddingTop);\n        }\n        if (paddingBottom != null && paddingBottom != \"\") {\n          yPadding = yPadding + parseFloat(paddingBottom);\n        }\n\n\n        const cameraPreviewOpts: CameraPreviewOptions = {\n          x: wrapperPosition.x + xPadding,\n          y: wrapperPosition.y + yPadding,\n          width: wrapperPosition.width - (xPadding * 2),\n          height: wrapperPosition.height - (yPadding * 2),\n          camera: 'rear',\n          tapPhoto: true,\n          previewDrag: false,\n          toBack: false,\n          alpha: 1\n        };\n\n\n        this.cameraPreview.stopCamera().then(() => {\n          this.cameraPreview.startCamera(cameraPreviewOpts).then((res) => {\n            this.isWebRTCAvailable = false;\n          }).catch((err) => { this.logger.log(err); });\n        }).catch((err) => {\n          this.logger.log(err);\n          this.cameraPreview.startCamera(cameraPreviewOpts).then((res) => {\n            this.isWebRTCAvailable = false;\n          }).catch((err) => { this.logger.log(err); });\n        });\n      } else {\n        this.nativePreviewInit();\n      }\n    }, 500);\n  }\n\n  public getMediaConstaint(): MediaStreamConstraints {\n    let videoVal = this.screenData.camFlag ? {\n      facingMode: this.screenData.camSide,\n      frameRate: {\n        ideal: 10,\n        min: 5,\n      },\n      noiseSuppression: true,\n      // deviceId: {},\n      // (this.screenData.videoSource) ? this.screenData.videoSource : undefined,\n      // width: { min: 144, max: 480, ideal: 360 },\n    } : false;\n\n    let audioVal = this.screenData.micFlag ? {\n      deviceId: (this.screenData.audioSource) ? this.screenData.audioSource : undefined,\n      echoCancellation: true\n    } : false;\n\n    let constraints: MediaStreamConstraints = {\n      video: videoVal,\n      audio: audioVal,\n    };\n\n    return constraints;\n  }\n\n\n  async startRecording() {\n    if (this.isWebRTCAvailable) {\n      this.screenData.chunks = [];\n      this.videoIsRecording = true;\n      this.screenData.recorder = new MediaRecorder(this.screenData.currentStream);\n      this.screenData.recorder.start();\n      this.screenData.recorder.ondataavailable = (event) => {\n        this.screenData.chunks.push(event.data);\n        let recordedBlob = new Blob(this.screenData.chunks, { type: \"video/webm\" });\n        let url = URL.createObjectURL(recordedBlob);\n        this.cd.detectChanges();\n        let userPreviewVideo: HTMLMediaElement = this.userVideoPreview.nativeElement;\n        userPreviewVideo.src = url;\n        // saveAs(recordedBlob, Date.now() + '.webm');\n        // let a = document.createElement('a');\n        // document.body.appendChild(a);\n        // // a.style = 'display: none';\n        // a.href = url;\n        // a.download = Date.now() + '.webm';\n        // a.click();\n        // window.URL.revokeObjectURL(url);\n      }\n    } else {\n\n    }\n  }\n\n  stopRecording() {\n    this.screenData.recorder.stop();\n    this.screenData.inProgress = false;\n  }\n\n  goToNext() {\n    const currentIndex = this.screenData.visibleImagesOnlyArray.findIndex(item => item.dynamicID === this.screenData.currentSelectedImageID);\n    const arrayLength = this.screenData.visibleImagesOnlyArray.length;\n    let startIndex = currentIndex;\n    if (startIndex == arrayLength - 1) {\n      startIndex = 0;\n    }\n    if (currentIndex != -1) {\n      let wasFound = false;\n      for (let i = startIndex; i < this.screenData.visibleImagesOnlyArray.length; i++) {\n        const element = this.screenData.visibleImagesOnlyArray[i];\n        if (currentIndex != i && !element.imageBase64Url) {\n          if (!element.imageBase64Url && !wasFound) {\n            wasFound = true;\n            this.checkSelectedMedia(element);\n            const reference = this.imagesReference.toArray()[i];\n            reference.nativeElement.scrollIntoView({ behavior: 'smooth' });\n            break;\n          }\n        }\n        if (!wasFound && startIndex != 0 && i == arrayLength - 1) {\n          startIndex = 0;\n          i = 0;\n        }\n      };\n    }\n  }\n\n  captureMedia() {\n    if (!this.screenData.inProgress) {\n      this.screenData.inProgress = true;\n    }\n    if (this.userVideoRef) {\n      if (this.screenData.currentSelectedImage.type == this.TYPE_VIDEO) {\n        if (this.isWebRTCAvailable) {\n          this.startRecording();\n        }\n      } else {\n        let base64URL = \"\";\n        let ext = \"jpeg\";\n        if (this.isWebRTCAvailable) {\n          let userVideo = this.userVideoRef.nativeElement;\n\n          let canvas = document.createElement(\"canvas\");\n          canvas.width = userVideo.videoWidth;\n          canvas.height = userVideo.videoHeight;\n          canvas.getContext('2d')\n            .drawImage(userVideo, 0, 0, canvas.width, canvas.height);\n\n          base64URL = canvas.toDataURL();\n          ext = \"png\";\n        } else {\n          const pictureOpts: CameraPreviewPictureOptions = {\n            quality: 100\n          }\n          this.cameraPreview.takePicture(pictureOpts).then((imageData) => {\n            base64URL = 'data:image/jpeg;base64,' + imageData;\n          }, (err) => { this.logger.error('error_taking_pic_key') });\n        }\n\n        this.screenData.visibleImagesOnlyArray.forEach(element => {\n          if (element.dynamicID === this.screenData.currentSelectedImageID) {\n            element.imageBase64Url = base64URL;\n            element.file = base64URL.split(',')[1];\n            element.fileExt = ext;\n            element.imageUrl = base64URL;\n          }\n        });\n        //check base64\n        this.goToNext();\n      }\n    }\n  }\n\n  async presentPopup() {\n\n\n    /* \n    \n     const id = 'ps-media-capture-modal';\n\n    const newOptions: IOptionsPsComplexMediaCaptureComponent = {};\n    CommonUtils.copyObject(newOptions, this.options, true);\n    newOptions.isAdvanced = true;\n    const finalOptions = { options: newOptions, lastStateData: this.screenData && this.screenData.lastStateData ? this.screenData.lastStateData : null }\n\n    const modal = await this.common.presentPopupScreen({\n      component: PsComplexMediaCaptureComponent,\n      componentOptions: finalOptions\n    }, id);\n\n    await modal.onDidDismiss().then(data => {\n      this.screenData.lastStateData = data['data'];\n    }).catch(error => this.common.logger.log(error));\n    \n    \n    */\n\n\n    const id = 'ps-media-capture-modal';\n\n    const newOptions: IOptionsPsComplexMediaCaptureComponent = {};\n    CommonUtils.copyObject(newOptions, this.options, true);\n    newOptions.isAdvanced = true;\n\n    this.modalController.dismiss(null, null, id);\n    const modal = await this.modalController.create({\n      component: PsComplexMediaCaptureComponent,\n      cssClass: id,\n      componentProps: { options: newOptions, lastStateData: this.screenData && this.screenData.lastStateData ? this.screenData.lastStateData : null },\n      backdropDismiss: true,\n      animated: false,\n      id: id\n    });\n    /* return */ await modal.present();\n    await modal.onDidDismiss().then(data => {\n      this.screenData.lastStateData = data['data'];\n    }).catch(error => this.common.logger.log(error));\n  }\n\n  dismissModal(justClose?) {\n    if (justClose) {\n      // this.userVideoPreview.nativeElement.scrollIntoView({ behavior: 'smooth' });\n      super.resetFileValController();\n      this.modalController.dismiss();\n    } else {\n      super.setFileValController(this.screenData?.visibleImagesOnlyArray.filter(b => b.imageBase64Url));\n      // this.onPsChange.emit();\n      this.modalController.dismiss(this.screenData, null, 'ps-media-capture-modal');\n    }\n  }\n\n  checkSelectedMedia(media: PsMediaCapture) {\n    if (media.type == this.TYPE_VIDEO) {\n      const modalID = 'ps-confirm-close';\n      const alertController: IOptionsPsComplexAlertController = {\n        cssClass: 'user-consent-popup',\n        header: 'you_will_be_recorded_key',\n        buttons: [\n          {\n            role: 'cancel',\n            options: {\n              labelKey: 'cancel_key',\n              psClass: 'ps-drafts-report-cancel-button',\n              group: this.options.group\n            },\n            handler: () => {\n              CommonUtils.dismissAllModals(null, null, modalID)\n            }\n          },\n          {\n            options: {\n              labelKey: 'ok_key',\n              psClass: 'ps-drafts-report-cancel-button',\n              group: this.options.group\n            },\n            handler: () => {\n              CommonUtils.dismissAllModals(null, null, modalID);\n              this.selectMedia(media);\n            }\n          }\n        ]\n      };\n      this.common.presentPsAlert(alertController, modalID);\n    } else {\n      this.selectMedia(media);\n    }\n  }\n\n  selectMedia(media: PsMediaCapture) {\n    this.screenData.currentSelectedImage = media;\n    this.screenData.visibleImagesOnlyArray.forEach(element => {\n      element.psClass = \"\";\n      if (element.dynamicID == media.dynamicID) {\n        element.psClass = \"ps-selected-image\";\n        this.screenData.currentSelectedImageID = media.dynamicID;\n      } else {\n        element.psClass = \"\";\n      }\n    });\n  }\n\n\n  createDynID(media: IOptionsPsActionImageExposed, id) {\n    media.dynamicID = id;\n    return id;\n  }\n\n  handleMouseEvent(type) {\n    this.onMouseDownFlag = type;\n    this.onMouseDownDrag = type;\n  }\n\n  onMouseDown(e) {\n    e.preventDefault();\n    // this.onMouseDownFlag = true;\n    this.onMouseDownDrag = true;\n    if (this.slider) {\n      this.startX = e.pageX - this.slider.nativeElement.offsetLeft;\n      this.scrollLeft = this.slider.nativeElement.scrollLeft;\n    }\n  }\n\n  handleOnMove(e) {\n    if (!this.onMouseDownDrag) {\n      return;\n    }\n    if (this.slider) {\n      this.onMouseDownFlag = true;\n      e.preventDefault();\n      const x = e.pageX - this.slider.nativeElement.offsetLeft;\n      const walk = (x - this.startX) * 2; //scroll-fast\n      this.slider.nativeElement.scrollLeft = this.scrollLeft - walk;\n    }\n  }\n\n  switchCamera() {\n    if (this.isWebRTCAvailable) {\n      const tracks = this.screenData.currentStream.getTracks();\n      tracks.forEach(track => track.stop());\n      if (this.screenData.camSide == \"environment\") {\n        this.screenData.camSide = \"user\";\n      } else {\n        this.screenData.camSide = \"environment\";\n      }\n      this.initFlow();\n    } else {\n      this.cameraPreview.switchCamera();\n    }\n  }\n\n  ngOnDestroy() {\n    this.cameraPreview.stopCamera();\n  }\n}\n"]}
(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{VEWP:function(t,e,o){"use strict";o.d(e,"a",function(){return f});var s=o("mrSG"),i=o("fXoL"),n=o("4lGw"),a=o("V0Fi"),l=o("ZyuK"),c=o("ZF3V"),p=o("EIUR"),r=o("DFXC"),u=o("zngb"),h=o("Q0Ba"),m=o("Isd1"),d=o("L0og");const y=["complexLookupComponentObj"];let f=(()=>{class t extends c.a{constructor(t,e,o,s){super(t,e),this.commonService=t,this.omniPull=o,this.accountsService=s,this.options={fromTo:"",requestObject:null},this.complexLookupOptions={requestObject:null,notFoundMessage:"no_valid_account_found_key",multiple:!!this.options.multiple&&this.options.multiple},this.onAccountChange=new i.o,this.onAccountDeleted=new i.o,this.labelValuesMap=new Map,this.psCurrency=new p.a,this.labelOptions={},this.allType=!1}ngOnInit(){this.loadAccounts(null),this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.title="title_key",this.complexLookupOptions.subTitle="sub_title_key",this.complexLookupOptions.labelsValueMap=this.labelValuesMap,this.allType=!!this.options.allType&&this.options.allType,this.commonProv.copyObject(this.complexLookupOptions,this.options,!1),this.complexLookupOptions.requestObject=this.options.requestObject}ngOnChanges(t){this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.placeHolder=this.options.placeHolder}loadAccounts(t){return Object(s.b)(this,void 0,void 0,function*(){if(null!=t&&(this.options=t),this.options.listOfAccounts=[],void 0===this.options.fromTo||""===this.options.fromTo)return void this.logger.error("lookup_from_to_missing_key");const e=this.commonService.session.getValueOf(u.a.USERINFO),o=this.prepareRequestData(e);this.returnAccountList(o)})}returnAccountList(t){return Object(s.b)(this,void 0,void 0,function*(){const e=this.commonProv.session.getValueOf(a.a.PERSONALIZATION_CO);this.complexLookupOptions.listOfOptions=void 0;const o=yield this.omniPull.returnAccounts(t).catch(t=>{this.complexLookupOptions.listOfOptions=[],this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",t)});if(o&&o.gridModel.length>0){if(this.allType){t.accountType="F",t.permittedGls="F";const e=yield this.omniPull.returnAccounts(t).catch(t=>{this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",t)});e&&e.gridModel.length>0&&(o.gridModel=[...o.gridModel,...e.gridModel])}if(this.options.listOfAccounts=o.gridModel,this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(t=>t.accountNumber!==this.options.accountNumber)),this.options.currency&&""!==this.options.currency&&(this.complexLookupOptions.listOfOptions=this.fetchAccountBasedOnCurrency(this.options.currency),this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(t=>t.accountNumber!==this.options.accountNumber))),null!=this.options.accountNumber&&""!==this.options.accountNumber||(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts),this.complexLookupOptions.listOfOptions=this.populateCustomAccounts(this.complexLookupOptions.listOfOptions),this.complexLookupOptions.listOfOptions.map((t,e)=>t.rowIndex=e),this.allAccounts=Object.assign([],this.complexLookupOptions.listOfOptions),null==this.complexLookupOptions.selectedItems&&(this.complexLookupOptions.selectedItems=[]),this.complexLookupOptions.multiple&&this.handleMultipleSelection(),!this.options.requestObject[this.options.fcName]&&(this.options.defaultByPersonalizedAcc=null==this.options.defaultByPersonalizedAcc||this.options.defaultByPersonalizedAcc,"from"===this.options.fromTo&&this.options.defaultByPersonalizedAcc)){let t="QR"===this.options.purpose?null==e?void 0:e.defaultQrPaymentAccKey:null==e?void 0:e.defaultTransferAccKey;this.complexLookupOptions.listOfOptions.map(e=>{e.personalizeKey&&e.personalizeKey===t&&(this.common.setValInsideNestedObj(this.options.fcName,e.lookupKey,this.options.requestObject),this.common.setValInsideNestedObj(this.options.fcName+"_lookupKey",e.lookupKey,this.options.requestObject))})}}else this.listOfAccounts=[],this.complexLookupOptions.listOfOptions=[]})}populateCustomAccounts(t){const e=[];for(const o of t){const t={briefNameEnglish:o.briefNameEnglish,cifShortNameEnglish:o.cifShortNameEnglish,accountNumber:o.accountNumber,balance:this.psCurrency.transform(null==o.balance?"0.0":o.balance,o.currencyDecimalPoints)+" "+(o.currencyBriefName||o.currencyBriefNameEnglish),availableBalance:this.psCurrency.transform(null==o.availableBalance?"0.0":o.availableBalance,o.currencyDecimalPoints)+" "+(o.currencyBriefName||o.currencyBriefNameEnglish),currencyBriefName:o.currencyBriefName||o.currencyBriefNameEnglish,currencyBriefNameEnglish:o.currencyBriefNameEnglish,currency:o.currency,accountTypeDesc:o.accountTypeDesc,additionalRef:o.additionalRef,ibanAccNo:o.ibanAccNo,accGl:o.accGl,serialNo:o.serialNo,branch:o.branch,cif:o.cif,formattedAccount:this.accountsService.returnFormattedAccount(o).formattedAccount,personalizeKey:o.personalizeKey,nickName:o.nickName,briefName:o.briefName,lookupKey:o.additionalRef,branchDescription:o.branchDescription?o.branchDescription:"",generalLedgerBriefNameEng:o.generalLedgerBriefNameEng?o.generalLedgerBriefNameEng:"",previewProperty:"accountNumber",status:o.statusDescription,statusCode:o.status,accountFormat:this.accountsService.returnFormattedAccount(o).accountFormat};this.options.multiple&&(t.excludeType=o.excludeType),e.push(t)}return e}prepareRequestData(t){let e={};if(t&&t.omniUserVO&&(e={userCifNo:t.omniUserVO.CIF_NO,type:"A"}),null!=this.options.queryParams&&void 0!==this.options.queryParams&&""!==this.options.queryParams&&(e={commonParametersList:this.options.queryParams}),null!=this.options.accountType&&void 0!==this.options.accountType&&""!==this.options.accountType&&(e.accountType=this.options.accountType),null!=this.options.glTypes&&void 0!==this.options.glTypes&&""!==this.options.glTypes&&(e.permittedGls=this.options.glTypes),null!=this.options.fromTo&&""!==this.options.fromTo&&(e.fromTo=this.options.fromTo),null!=this.options.endUserId&&""!==this.options.endUserId&&(e.endUserId=this.options.endUserId),null!=this.options.fromCurrency?e.fromCurrency=this.options.fromCurrency:null!=this.options.toCurrency&&(e.toCurrency=this.options.toCurrency),null!=this.options.accountAllowedCurrencies&&void 0!==this.options.accountAllowedCurrencies)if("string"==typeof this.options.accountAllowedCurrencies)e.accountAllowedCurrencies=this.options.accountAllowedCurrencies;else{let t="";for(const e in this.options.accountAllowedCurrencies)t+=this.options.accountAllowedCurrencies[e]+",";t=t.slice(0,t.lastIndexOf(",")),e.accountAllowedCurrencies=t}if(null!=this.options.accountAllowedTypes&&void 0!==this.options.accountAllowedTypes)if("string"==typeof this.options.accountAllowedTypes)e.accountAllowedTypes=this.options.accountAllowedTypes;else{let t="";for(const e in this.options.accountAllowedTypes)t+=this.options.accountAllowedTypes[e]+",";t=t.slice(0,t.lastIndexOf(",")),e.accountAllowedTypes=t}return e}fetchAccountBasedOnCurrency(t){return this.options.listOfAccounts}onChange(t){this.logger.log(t)}populateOwnAccountMap(){let t={},e={},o={};t={key:"accountNumber",value:"--- --- --- ---",isEdit:!1},e={key:"currentBalance",value:"0.0",isEdit:!1},o={key:"availableBalance",value:"0.0",isEdit:!1},this.labelValuesMap.set("account_key",t),this.labelValuesMap.set("balance_key",e),this.labelValuesMap.set("available_balance_key",o)}onChangeItem(t){this.onAccountChange.emit(t)}onDeleteItem(t){t&&this.onAccountDeleted.emit(t)}handleMultipleSelection(){const t=this.options.setAllAccountsAsSelecetd?this.complexLookupOptions.listOfOptions:this.options.requestObject[this.options.fcName]?this.complexLookupOptions.listOfOptions.filter(t=>this.options.requestObject[this.options.fcName].some(e=>e.accountNumber==t.accountNumber)):[];this.complexLookupOptions.selectedItems=t.filter(t=>this.options.setAllAccountsAsSelecetd&&(!t.excludeType||!(t.excludeType.includes(a.a.GENERAL_ACCOUNT_EXCLUDE_TYPE)||t.excludeType.includes(a.a.TERM_ACCOUNT_EXCLUDE_TYPE)))||!this.options.setAllAccountsAsSelecetd).map(t=>Object.assign(Object.assign({item:t[t.previewProperty]},t),{itemLookup:t.lookupKey})),this.complexLookupOptions.selectedItems.length>0&&this.complexLookupComponentObj.setSelectedItems(this.complexLookupOptions.selectedItems)}removeAccount(t){t&&void 0!==this.allAccounts&&(this.complexLookupOptions.listOfOptions=this.allAccounts?this.allAccounts.filter(e=>t.accountNumber!=e.accountNumber):[])}reset(){this.complexLookupComponentObj.resetLookUp()}refreshAcounts(t){this.complexLookupOptions.listOfOptions=Object.assign([],this.allAccounts),this.removeAccount(t)}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(h.a),i.Rb(r.a),i.Rb(l.a),i.Rb(n.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["ps-lookup-own-accounts"]],viewQuery:function(t,e){if(1&t&&i.Wc(y,1),2&t){let t;i.Bc(t=i.gc())&&(e.complexLookupComponentObj=t.first)}},inputs:{options:"options"},outputs:{onAccountChange:"onAccountChange",onAccountDeleted:"onAccountDeleted"},features:[i.Cb,i.Db],decls:3,vars:2,consts:[[1,"ps-complex-own-account"],[3,"id","options","changeItem","onDeleteItem"],["complexLookupComponentObj",""]],template:function(t,e){1&t&&(i.Xb(0,"ps-container-complex",0),i.Xb(1,"ps-complex-lookup",1,2),i.fc("changeItem",function(t){return e.onChangeItem(t)})("onDeleteItem",function(t){return e.onDeleteItem(t)}),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.pc("id",e.id)("options",e.complexLookupOptions))},directives:[m.a,d.a],styles:[""]}),t})()},dtly:function(t,e,o){"use strict";o.d(e,"a",function(){return m});var s=o("mrSG"),i=o("fXoL"),n=o("ZyuK"),a=o("ZF3V"),l=o("EIUR"),c=o("nipE"),p=o("DFXC"),r=o("Q0Ba"),u=o("Isd1"),h=o("L0og");let m=(()=>{class t extends a.a{constructor(t,e,o){super(t,e),this.commonService=t,this.omniPull=o,this.options={requestObject:null},this.onDealChange=new i.o,this.complexLookupOptions={requestObject:null,notFoundMessage:"no_deals_found_key"},this.labelValuesMap=new Map}ngOnInit(){super.init(),this.loadDeals(),this.complexLookupOptions.title="title_key",this.complexLookupOptions.subTitle="sub_title_key",this.complexLookupOptions.labelsValueMap=this.labelValuesMap,this.commonProv.copyObject(this.complexLookupOptions,this.options,!1),this.complexLookupOptions.requestObject=this.options.requestObject}loadDeals(){this.returnDealList({status:"A"})}returnDealList(t){return Object(s.b)(this,void 0,void 0,function*(){const e=yield this.omniPull.returnDealList(t).catch(t=>{this.complexLookupOptions.listOfOptions=[],this.logger.error("Error: While fetching deals in PsLookupOwnDealsComponent :",t)});this.complexLookupOptions.listOfOptions=e&&e.gridModel.length>0?this.handelDealResponseLabels(e.gridModel):[]})}onChangeItem(t){this.onDealChange.emit(t)}handelDealResponseLabels(t){let e=[];const o=new l.a,s=new c.a;for(const i of t){const t={title:(i.productClassName||"")+"  "+(i.dealCurrencyDescription||""),subTitle:i.nickName||i.dealNumber,nextPaymentDate:i.nextPaymentDate?s.transform(i.nextPaymentDate,"DD/MM/YYYY"):"--/--/----",nextPaymentVal:o.transform((i.nextPaymentAmount||0).toString(),2)+" "+(i.dealCurrencyDescription||""),paidAmount:o.transform((i.paidAmount||0).toString(),2)+" "+(i.dealCurrencyDescription||""),amount:o.transform((i.financeAmount||0).toString(),2)+" "+(i.dealCurrencyDescription||""),lastPaymentDate:i.lastSettledDate?s.transform(i.lastSettledDate,"DD/MM/YYYY"):"--/--/----",lastPaymentAmount:o.transform((i.lastSettledAmount||0).toString(),2)+" "+(i.dealCurrencyDescription||""),maturityDate:i.maturityDate?s.transform(i.maturityDate,"DD/MM/YYYY"):"--/--/----",outstandingBalanceDesc:o.transform((i.outstandingBalance||0).toString(),2)+" "+(i.dealCurrencyDescription||""),outstandingBalance:i.outstandingBalance||0,noOfRemainingIns:i.noOfRemainingInstallment||0,currency:i.dealCurrencyDescription||"",financingType:i.financingType||"",periodicityPayment:this.getFormattedPeriodicity(i.installmentAmount||0,i.dealCurrencyDescription||"",i.paymentPeriodicityType,i.paymentPeriodicityNumber),pastDues:o.transform((i.pastDueAmount||0).toString(),2)+" "+(i.dealCurrencyDescription||""),key:i.personalizeKey,dealNbr:i.dealNumber,lookupKey:i.personalizeKey,currencyCode:i.dealCurrency,previewProperty:"title"};e.push(t)}return e}getFormattedPeriodicity(t,e,o,s){let i="",n="";switch(o){case"M":"1"===s?n="Monthly":"2"===s?n="Bimonthly":"3"===s?n="Quarterly":"6"===s?n="Half Yearly":"12"===s&&(n="Yearly");break;case"D":n="Every "+s+" Days"}return i=n||"--",i}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(r.a),i.Rb(p.a),i.Rb(n.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["ps-lookup-own-deals"]],inputs:{options:"options"},outputs:{onDealChange:"onDealChange"},features:[i.Cb],decls:2,vars:2,consts:[[1,"ps-complex-own-deals"],[3,"id","options","changeItem"]],template:function(t,e){1&t&&(i.Xb(0,"ps-container-complex",0),i.Xb(1,"ps-complex-lookup",1),i.fc("changeItem",function(t){return e.onChangeItem(t)}),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.pc("id",e.id)("options",e.complexLookupOptions))},directives:[u.a,h.a],styles:[""]}),t})()},qnJ5:function(t,e,o){"use strict";o.d(e,"a",function(){return h});var s=o("fXoL"),i=o("fOh1"),n=o("zngb"),a=o("ZF3V"),l=o("DFXC"),c=o("Q0Ba"),p=o("ofXK"),r=o("BygU");function u(t,e){if(1&t){const t=s.Yb();s.Xb(0,"ps-container-lookup-option",1),s.fc("clickedCard",function(e){return s.Fc(t),s.ic().updateCard(e)}),s.Wb()}if(2&t){const t=e.$implicit,o=e.index,i=s.ic();s.pc("id","deals-list-"+i.id+o)("options",i.getOptionsForCard(t))("itemCard",t)}}let h=(()=>{class t extends a.a{constructor(t,e){super(t,e),this.commonP=t,this.loggerC=e,this.onClickCard=new s.o,this.containerLookUpOptions={},this.dealsLabelValuesMap=new Map,this.dealsHeaderMap=new Map,this.requestMap=new Map,this.editRequestMap=new Map,this.showSingleAccount=!1,this.populateHeaderValueMap()}ngOnInit(){this.containerLookUpOptions.labelKey=this.options.labelKey,this.containerLookUpOptions.currencyFlag="currencyBriefNameEnglish",this.containerLookUpOptions.labelsValueMap=this.dealsLabelValuesMap,this.containerLookUpOptions.headerMap=this.dealsHeaderMap,this.containerLookUpOptions.formGroup=this.options.group,this.containerLookUpOptions.balanceMapping=this.balanceMapping(),this.containerLookUpOptions.isEditable=this.options.isEditable,this.containerLookUpOptions.editActionUrl=i.a.serviceUrl.personalizationNicknameEndPoint,this.containerLookUpOptions.requestMap=this.requestMap,this.containerLookUpOptions.editRequestMap=this.editRequestMap,this.containerLookUpOptions.pageData={operID:n.a.DEAL_REPORT,title:"deal_report_key"},this.options&&this.options.listOfOptions&&(this.options.listOfOptions.map((t,e)=>t.rowIndex=e),this.options.itemList=this.options.listOfOptions),this.containerLookUpOptions.actionDetailsOptions=[{}],this.containerLookUpOptions.statementOptions={buttonIcon:"facilities",redirectUrl:"deal-statement-report"}}getOptionsForCard(t){return Object.assign(Object.assign({},this.containerLookUpOptions),{fcName:this.options.fcName+t.dealNbr})}trackByDealNumber(t,e){var o;return null!==(o=null==e?void 0:e.dealNbr)&&void 0!==o?o:t}balanceMapping(){return[{key:"settled_amount_key",value:"paidAmount"},{key:"outstanding_balance_key",value:"outstandingBalance"}]}populateHeaderValueMap(){let t={},e={},o={},s={},i={},n={},a={},l={},c={},p={},r={},u={},h={};o={key:"nextPaymentDate",value:"---/--/----"},s={key:"nextPaymentVal",value:"0.0"},n={key:"paidAmount",value:"0.0"},i={key:"amount",value:"0.0"},a={key:"maturityDate",value:"---/--/----"},l={key:"pastDues",value:"0.0"},c={key:"lastPaymentDate",value:"---/--/----"},p={key:"lastPaymentAmount",value:"0.0"},r={key:"outstandingBalanceDesc",value:"0.0"},u={key:"noOfRemainingIns",value:"0"},h={key:"periodicityPayment",value:"0"},t={key:"title",value:"title",isEdit:!1,formGroupMap:{placeHolder:"title_key",fcName:"title"}},e={key:"subTitle",value:"nickName",isEdit:!0,formGroupMap:{placeHolder:"enter_deal_nick",fcName:"nickName"}},this.dealsLabelValuesMap.set("financing_amount_key",i),this.dealsLabelValuesMap.set("maturity_date_key",a),this.dealsLabelValuesMap.set("payment_key",h),this.dealsLabelValuesMap.set("no_remaining_installments_key",u),this.dealsLabelValuesMap.set("settled_amount_key",n),this.dealsLabelValuesMap.set("outstanding_balance_key",r),this.dealsLabelValuesMap.set("past_dues_key",l),this.dealsLabelValuesMap.set("last_payment_date_key",c),this.dealsLabelValuesMap.set("last_payment_amount_key",p),this.dealsLabelValuesMap.set("next_payment_date_key",o),this.dealsLabelValuesMap.set("next_payment_amount_key",s),this.dealsHeaderMap.set("title",t),this.dealsHeaderMap.set("subTitle",e),this.requestMap.set("nickNameNumber","key"),this.requestMap.set("oldNickName","subTitle"),this.editRequestMap.set("newNickName","subTitle"),this.editRequestMap.set("type","A")}updateCard(t){t&&this.options.listOfOptions&&(this.options.itemList=this.options.listOfOptions.filter(e=>e===t),this.options.item=this.options.itemList[0],this.showSingleAccount=!this.showSingleAccount,this.options.showItemPopUp=!this.options.showItemPopUp),this.onClickCard.emit(this.options)}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(c.a),s.Rb(l.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["ps-complex-deal-details"]],inputs:{options:"options",itemCard:"itemCard"},outputs:{onClickCard:"onClickCard"},features:[s.Cb],decls:1,vars:2,consts:[[3,"id","options","itemCard","clickedCard",4,"ngFor","ngForOf","ngForTrackBy"],[3,"id","options","itemCard","clickedCard"]],template:function(t,e){1&t&&s.Pc(0,u,1,3,"ps-container-lookup-option",0),2&t&&s.pc("ngForOf",e.options.itemList)("ngForTrackBy",e.trackByDealNumber)},directives:[p.n,r.a],styles:[""]}),t})()}}]);
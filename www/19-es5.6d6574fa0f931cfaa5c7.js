!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,i,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function s(e,r,a,o){var s=r&&r.prototype instanceof l?r:l,u=Object.create(s.prototype);return t(u,"_invoke",function(e,t,r){var a,o,s,l=0,u=r||[],p=!1,f={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(e,t){return a=e,o=0,s=n,f.n=t,c}};function d(e,t){for(o=e,s=t,i=0;!p&&l&&!r&&i<u.length;i++){var r,a=u[i],d=f.p,v=a[2];e>3?(r=v===t)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=n):a[0]<=d&&((r=e<2&&d<a[1])?(o=0,f.v=t,f.n=a[1]):d<v&&(r=e<3||a[0]>t||t>v)&&(a[4]=e,a[5]=t,f.n=v,o=0))}if(r||e>1)return c;throw p=!0,t}return function(r,u,v){if(l>1)throw TypeError("Generator is already running");for(p&&1===u&&d(u,v),o=u,s=v;(i=o<2?n:s)||!p;){a||(o?o<3?(o>1&&(f.n=-1),d(o,s)):f.n=s:f.v=s);try{if(l=2,a){if(o||(r="next"),i=a[r]){if(!(i=i.call(a,s)))throw TypeError("iterator result is not an object");if(!i.done)return i;s=i.value,o<2&&(o=0)}else 1===o&&(i=a.return)&&i.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),o=1);a=n}else if((i=(p=f.n<0)?s:e.call(t,f))!==c)break}catch(i){a=n,o=1,s=i}finally{l=1}}return{value:i,done:p}}}(e,a,o),!0),u}var c={};function l(){}function u(){}function p(){}i=Object.getPrototypeOf;var f=[][a]?i(i([][a]())):(t(i={},a,function(){return this}),i),d=p.prototype=l.prototype=Object.create(f);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,t(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=p,t(d,"constructor",p),t(p,"constructor",u),u.displayName="GeneratorFunction",t(p,o,"GeneratorFunction"),t(d),t(d,o,"Generator"),t(d,a,function(){return this}),t(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m:v}})()}function t(e,n,i,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(t=function(e,n,i,r){function o(n,i){t(e,n,function(e){return this._invoke(n,i,e)})}n?a?a(e,n,{value:i,enumerable:!r,configurable:!r,writable:!r}):e[n]=i:(o("next",0),o("throw",1),o("return",2))})(e,n,i,r)}function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t,n){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(t,n||[],l(e).constructor):t.apply(e,n))}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(a=function(){return!!e})()}function o(e,t,n,i){var r=s(l(1&i?e.prototype:e),t,n);return 2&i&&"function"==typeof r?function(e){return r.apply(n,e)}:r}function s(){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=c(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(null,arguments)}function c(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,v(i.key),i)}}function d(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(window.webpackJsonp=window.webpackJsonp||[]).push([[19,339,340,341,342,343,344,345,346,347,348,349],{gKqT:function(e,t,n){"use strict";n.r(t),n.d(t,"OmniBasePage",function(){return f});var i=n("oS+F"),r=n("zngb"),a=n("QZhd"),o=n("woXy"),s=n("qEF5"),c=n("Q0Ba"),l=n("lE2x"),u=n("fXoL"),f=function(){var e=function(){return d(function e(){p(this,e),this.isPageDisabled=!1,this.commonProv=s.a.injectionHandler(c.a),this.navigationServices=s.a.injectionHandler(o.a)},[{key:"init",value:function(){this.currentOperID=a.a.oper_ID,this.customizationMap=this.commonProv.returnOperCustomization();var e=this.navigationServices.getAllParams(),t={};e&&!0===e.readOnlypage?(t.IS_READONLY=1,this.customizationMap&&this.customizationMap.set(r.a.FORM_READONLY,t)):this.customizationMap&&(t.IS_READONLY=0,this.customizationMap.set(r.a.FORM_READONLY,t)),this.screenTranslationOperIds=l.a.MAIN_CONFIG.SCREEN_TRANSLATION_OPER?l.a.MAIN_CONFIG.SCREEN_TRANSLATION_OPER:[],this.screenTranslationOperIds.length>0&&this.screenTranslationOperIds.includes(this.currentOperID)&&this.getScreenTranslations(this.currentOperID)}},{key:"ngOnInit",value:function(){this.init()}},{key:"ionViewDidEnter",value:function(){this.viewDidEnter()}},{key:"ionViewWillLeave",value:function(){this.viewWillLeave()}},{key:"ionViewWillEnter",value:function(){this.viewWillEnter()}},{key:"viewWillEnter",value:function(){}},{key:"disableForm",value:function(e){var t=this;if(void 0!==e&&this.customizationMap){var n=this.customizationMap.get(r.a.FORM_READONLY);n&&1===n.IS_READONLY&&"DISABLED"!=e.status&&(e.disable(),Object.keys(e.controls).forEach(function(e){t.commonProv.applyDynScreenDisplay(r.a.ACTION_TYPE_READONLY,[e],1)}))}}},{key:"viewDidEnter",value:function(){this.commonProv.checkViewBS.next({value:!0,page:this,didEnter:!0}),this.commonProv.setCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID),this.commonProv.emitCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID,{value:!0,page:this,didEnter:!0}),this.commonProv.dismissLoading(),this.disableForm(this.baseFormGroup),i.a.getAllSessionFcVars(this.baseFormGroup),this.commonProv.setFormGroupByOper(this.baseFormGroup)}},{key:"viewWillLeave",value:function(){this.commonProv.checkViewBS.next({value:!0,page:this,willLeave:!0}),this.commonProv.setCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID),this.commonProv.emitCheckViewByOper(this.currentOperID?this.currentOperID:a.a.oper_ID,{value:!0,page:this,willLeave:!0})}},{key:"ngAfterViewChecked",value:function(){var e=this;this.isPageDisabled||setTimeout(function(){e.disableForm(e.baseFormGroup),e.isPageDisabled=!0},300)}},{key:"getScreenTranslations",value:function(e){var t=e||2222,n=a.a.activeLanguge?a.a.activeLanguge:"EN";t&&n&&this.commonProv.language.getOperTranslation(n,t)}}])}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=u.Lb({type:e,selectors:[["app-omni-base"]],hostVars:2,hostBindings:function(e,t){2&e&&u.Hb(t.psClass)},decls:0,vars:0,template:function(e,t){},styles:[""]}),e}()},xdyT:function(t,i,a){"use strict";a.d(i,"a",function(){return z});var s=a("mrSG"),c=a("fXoL"),l=a("8Y4A"),f=a("jNcp"),v=a("qEF5"),m=a("lE2x"),h=a("Q0Ba"),g=a("V0Fi"),b=a("TEn/"),y=a("ofXK"),w=a("ilDp"),D=a("5YYs"),I=a("hUjg"),O=a("KVmc"),P=["userVideo"],k=["userVideoPreview"],E=["slider"],C=["userVideoWrapper"],S=["imageReference"];function F(e,t){if(1&e){var n=c.Yb();c.Xb(0,"div",6),c.Xb(1,"div",7),c.fc("click",function(){return c.Fc(n),c.ic(2).dismissModal(!0)}),c.Sb(2,"ps-action-icon",8),c.Wb(),c.Wb()}if(2&e){var i=c.ic(2);c.Fb(2),c.pc("options",i.closeIcon)}}function _(e,t){if(1&e){var n=c.Yb();c.Xb(0,"ps-action-icon",15),c.fc("onClick",function(){return c.Fc(n),c.ic(3).switchCamera()}),c.Wb()}if(2&e){var i=c.ic(3);c.pc("options",i.switchIcon)}}function A(e,t){if(1&e){var n=c.Yb();c.Vb(0),c.Xb(1,"ps-action-image",19,20),c.fc("click",function(){c.Fc(n);var e=c.ic().$implicit;return c.ic(4).checkSelectedMedia(e)}),c.Wb(),c.Ub()}if(2&e){var i=c.ic().$implicit;c.Fb(1),c.pc("options",i)("id",i.dynamicID)}}function R(e,t){if(1&e){var n=c.Yb();c.Vb(0),c.Xb(1,"video",21,22),c.fc("click",function(){c.Fc(n);var e=c.ic().$implicit;return c.ic(4).checkSelectedMedia(e)}),c.Wb(),c.Ub()}}function M(e,t){if(1&e&&(c.Vb(0),c.Pc(1,A,3,2,"ng-container",0),c.Pc(2,R,3,0,"ng-container",0),c.Ub()),2&e){var n=t.$implicit,i=c.ic(4);c.Fb(1),c.pc("ngIf",n.type==i.TYPE_IMAGE),c.Fb(1),c.pc("ngIf",n.type==i.TYPE_VIDEO)}}var V=function(e){return{active:e}};function T(e,t){if(1&e){var n=c.Yb();c.Xb(0,"div",16,17),c.fc("mousedown",function(e){return c.Fc(n),c.ic(3).onMouseDown(e)})("mouseup",function(){return c.Fc(n),c.ic(3).handleMouseEvent(!1)})("mouseleave",function(){return c.Fc(n),c.ic(3).handleMouseEvent(!1)})("mousemove",function(e){return c.Fc(n),c.ic(3).handleOnMove(e)}),c.Pc(2,M,3,2,"ng-container",18),c.Wb()}if(2&e){var i=c.ic(3);c.pc("ngClass",c.sc(2,V,i.onMouseDownFlag)),c.Fb(2),c.pc("ngForOf",i.screenData.visibleImagesOnlyArray)}}function W(e,t){if(1&e&&(c.Vb(0),c.Xb(1,"div",9,10),c.Sb(3,"div"),c.Sb(4,"video",11,12),c.Pc(6,_,1,1,"ps-action-icon",13),c.Wb(),c.Pc(7,T,3,4,"div",14),c.Ub()),2&e){var n=c.ic(2);c.Fb(6),c.pc("ngIf",(null==n.sources?null:n.sources.length)>=2||n.commonP.isNativeMobile()),c.Fb(1),c.pc("ngIf",n.screenData.visibleImagesOnlyArray.length>0)}}var N=function(e,t){return{"col-12":e,"col-6":t}};function j(e,t){if(1&e){var n=c.Yb();c.Xb(0,"ps-action-button",25),c.fc("onClick",function(){return c.Fc(n),c.ic(3).dismissModal()}),c.Wb()}if(2&e){var i=c.ic(3);c.pc("ngClass",c.tc(2,N,!i.screenData.inProgress,i.screenData.inProgress))("options",i.doneOptions)}}function L(e,t){if(1&e){var n=c.Yb();c.Vb(0),c.Xb(1,"ps-action-button",23),c.fc("onClick",function(){c.Fc(n);var e=c.ic(2);return e.screenData.flowWasInitialized?e.captureMedia():e.presentPopup()}),c.Wb(),c.Pc(2,j,1,5,"ps-action-button",24),c.Ub()}if(2&e){var i=c.ic(2);c.Fb(1),c.pc("options",i.options.mediaButton)("ngClass",c.tc(3,N,!i.screenData.inProgress,i.screenData.inProgress)),c.Fb(1),c.pc("ngIf",i.screenData.inProgress)}}function B(e,t){if(1&e){var n=c.Yb();c.Xb(0,"ps-action-button",26),c.fc("onClick",function(){return c.Fc(n),c.ic(2).stopRecording()}),c.Wb()}if(2&e){var i=c.ic(2);c.pc("options",i.stopVideoRecordingLabel)}}var Y=function(e,t){return{"flow-initialized":e,"flow-not-initialized":t}};function U(e,t){if(1&e&&(c.Vb(0),c.Pc(1,F,3,1,"div",2),c.Xb(2,"div",3),c.Pc(3,W,8,2,"ng-container",0),c.Xb(4,"div",4),c.Pc(5,L,3,6,"ng-container",0),c.Pc(6,B,1,1,"ps-action-button",5),c.Wb(),c.Wb(),c.Ub()),2&e){var n=c.ic();c.Fb(1),c.pc("ngIf",null==n.options?null:n.options.isAdvanced),c.Fb(1),c.pc("ngClass",c.tc(5,Y,n.screenData.flowWasInitialized,!n.screenData.flowWasInitialized)),c.Fb(1),c.pc("ngIf",null==n.options?null:n.options.isAdvanced),c.Fb(2),c.pc("ngIf",!n.videoIsRecording),c.Fb(1),c.pc("ngIf",n.videoIsRecording)}}function X(e,t){if(1&e&&c.Sb(0,"ps-label",29),2&e){var n=c.ic(2);c.pc("id","lbl_"+n.id)("options",n.options.mediaButton)}}function G(e,t){if(1&e&&(c.Vb(0),c.Sb(1,"ps-action-image",30),c.Ub()),2&e){var n=t.$implicit;c.Fb(1),c.pc("options",n)}}function x(e,t){if(1&e&&(c.Xb(0,"div",27),c.Pc(1,X,1,2,"ps-label",28),c.Pc(2,G,2,1,"ng-container",18),c.Wb()),2&e){var n=c.ic();c.Fb(1),c.pc("ngIf",n.options.mediaButton),c.Fb(1),c.pc("ngForOf",n.screenData.visibleImagesOnlyArray)}}var z=function(){var t=function(t){function i(e,t,n,a,o){var s;return p(this,i),(s=r(this,i,[e,e.logger,t])).commonP=e,s.elRefC=t,s.cd=n,s.modalController=a,s.cameraPreview=o,s.screenData={micFlag:!1,camFlag:!0,camSide:"user",audioSource:null,videoSource:null,currentStream:null,recorder:null,chunks:[],previewImages:[],flowWasInitialized:!1,inProgress:!1,lastState:!1,lastStateData:{},numberOfImages:m.a.CLIENT_ASSETS_CONFIG.UI_CONFIGURATION.MAX_NUMBER_OF_IMAGES_IN_MEDIA_CAPTURE,currentSelectedImageID:"",currentSelectedImage:null,visibleImagesOnlyArray:[]},s.switchIcon={iconName:"cam-switch"},s.posterIcon={imageName:"camera.svg"},s.onMouseDownFlag=!1,s.onMouseDownDrag=!1,s.sources=[],s.TYPE_VIDEO=g.a.TYPE_VIDEO,s.TYPE_IMAGE=g.a.TYPE_IMAGE,s.closeIcon={iconName:"close",labelOptions:{labelKey:""}},s.videoIsRecording=!1,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(i,t),d(i,[{key:"ngOnInit",value:function(){o(i,"init",this,3)([]),this.options&&this.options.group&&(this.doneOptions={labelKey:"done_key",group:this.options.group},this.stopVideoRecordingLabel={labelKey:"stop_recording_key",group:this.options.group},this.options.numberOfImages>0&&(this.screenData.numberOfImages=this.options.numberOfImages))}},{key:"ngAfterViewInit",value:function(){if(this.options&&this.options.isAdvanced){if(v.a.isEmptyObject(this.lastStateData))for(var e=0;e<this.screenData.numberOfImages;e++){var t=this.options.fcName+"_img_"+e+"."+v.a.getCssVariableValue("--ps-preview-image-extension-format"),n={imageName:t,labelOptions:{labelKey:this.options.fcName+"_label_"+e},dynamicID:this.options.fcName+"_"+e,fallBackImageName:"add.svg",type:"image",fileName:t,fileExt:v.a.getCssVariableValue("--ps-preview-image-extension-format"),status:"N",isImage:!0};this.screenData.previewImages.push(n),this.custMode?this.screenData.visibleImagesOnlyArray.push(n):this.checkCustomization(n.dynamicID,n)}else v.a.copyObject(this.screenData,this.lastStateData,!0);this.initFlow()}}},{key:"checkCustomization",value:function(e,t){1==this.commonProv.getElementValidations(e).IS_VISIBLE&&this.screenData.visibleImagesOnlyArray.push(t)}},{key:"initFlow",value:function(){if(this.userVideoRef)if(v.a.isNativeMobile())try{this.nativePreviewInit()}catch(e){this.fallBackInit()}else this.fallBackInit()}},{key:"fallBackInit",value:function(){try{this.initWebRTCFlow()}catch(e){v.a.presentFailureAlert("camera_preview_not_avail_key")}}},{key:"initWebRTCFlow",value:function(){var t=this,i=this.userVideoRef.nativeElement;i.muted=!0,i.autoplay=!0,navigator.mediaDevices.getUserMedia(this.getMediaConstaint()).then(function(r){return Object(s.b)(t,void 0,void 0,e().m(function t(){var a=this;return e().w(function(e){for(;;)switch(e.n){case 0:return this.isWebRTCAvailable=!0,navigator.mediaDevices.enumerateDevices().then(function(e){var t=e.filter(function(e){return"videoinput"===e.kind});a.sources=n(t)}),this.screenData.currentStream=r,i&&(i.srcObject=null),i.srcObject=r,e.n=1,i.play();case 1:this.screenData.flowWasInitialized=!0,this.checkSelectedMedia(this.screenData.visibleImagesOnlyArray[0]);case 2:return e.a(2)}},t,this)}))}).catch(function(e){t.logger.log(e),t.nativePreviewInit()})}},{key:"nativePreviewInit",value:function(){var e=this;setTimeout(function(){if(e.userVideoWrapper&&e.userVideoWrapper.nativeElement){var t=e.userVideoWrapper.nativeElement.getBoundingClientRect(),n=getComputedStyle(e.userVideoWrapper.nativeElement)["padding-left"],i=getComputedStyle(e.userVideoWrapper.nativeElement)["padding-right"],r=getComputedStyle(e.userVideoWrapper.nativeElement)["padding-top"],a=getComputedStyle(e.userVideoWrapper.nativeElement)["padding-bottom"],o=0,s=0;null!=n&&""!=n&&(o+=parseFloat(n)),null!=i&&""!=i&&(o+=parseFloat(i)),null!=r&&""!=r&&(s+=parseFloat(r)),null!=a&&""!=a&&(s+=parseFloat(a));var c={x:t.x+o,y:t.y+s,width:t.width-2*o,height:t.height-2*s,camera:"rear",tapPhoto:!0,previewDrag:!1,toBack:!1,alpha:1};e.cameraPreview.stopCamera().then(function(){e.cameraPreview.startCamera(c).then(function(t){e.isWebRTCAvailable=!1}).catch(function(t){e.logger.log(t)})}).catch(function(t){e.logger.log(t),e.cameraPreview.startCamera(c).then(function(t){e.isWebRTCAvailable=!1}).catch(function(t){e.logger.log(t)})})}else e.nativePreviewInit()},500)}},{key:"getMediaConstaint",value:function(){return{video:!!this.screenData.camFlag&&{facingMode:this.screenData.camSide,frameRate:{ideal:10,min:5},noiseSuppression:!0},audio:!!this.screenData.micFlag&&{deviceId:this.screenData.audioSource?this.screenData.audioSource:void 0,echoCancellation:!0}}}},{key:"startRecording",value:function(){return Object(s.b)(this,void 0,void 0,e().m(function t(){var n=this;return e().w(function(e){for(;;)switch(e.n){case 0:this.isWebRTCAvailable&&(this.screenData.chunks=[],this.videoIsRecording=!0,this.screenData.recorder=new MediaRecorder(this.screenData.currentStream),this.screenData.recorder.start(),this.screenData.recorder.ondataavailable=function(e){n.screenData.chunks.push(e.data);var t=new Blob(n.screenData.chunks,{type:"video/webm"}),i=URL.createObjectURL(t);n.cd.detectChanges(),n.userVideoPreview.nativeElement.src=i});case 1:return e.a(2)}},t,this)}))}},{key:"stopRecording",value:function(){this.screenData.recorder.stop(),this.screenData.inProgress=!1}},{key:"goToNext",value:function(){var e=this,t=this.screenData.visibleImagesOnlyArray.findIndex(function(t){return t.dynamicID===e.screenData.currentSelectedImageID}),n=this.screenData.visibleImagesOnlyArray.length,i=t;if(i==n-1&&(i=0),-1!=t)for(var r=!1,a=i;a<this.screenData.visibleImagesOnlyArray.length;a++){var o=this.screenData.visibleImagesOnlyArray[a];if(t!=a&&!o.imageBase64Url&&!o.imageBase64Url&&!r){r=!0,this.checkSelectedMedia(o),this.imagesReference.toArray()[a].nativeElement.scrollIntoView({behavior:"smooth"});break}r||0==i||a!=n-1||(i=0,a=0)}}},{key:"captureMedia",value:function(){var e=this;if(this.screenData.inProgress||(this.screenData.inProgress=!0),this.userVideoRef)if(this.screenData.currentSelectedImage.type==this.TYPE_VIDEO)this.isWebRTCAvailable&&this.startRecording();else{var t="",n="jpeg";if(this.isWebRTCAvailable){var i=this.userVideoRef.nativeElement,r=document.createElement("canvas");r.width=i.videoWidth,r.height=i.videoHeight,r.getContext("2d").drawImage(i,0,0,r.width,r.height),t=r.toDataURL(),n="png"}else this.cameraPreview.takePicture({quality:100}).then(function(e){t="data:image/jpeg;base64,"+e},function(t){e.logger.error("error_taking_pic_key")});this.screenData.visibleImagesOnlyArray.forEach(function(i){i.dynamicID===e.screenData.currentSelectedImageID&&(i.imageBase64Url=t,i.file=t.split(",")[1],i.fileExt=n,i.imageUrl=t)}),this.goToNext()}}},{key:"presentPopup",value:function(){return Object(s.b)(this,void 0,void 0,e().m(function t(){var n,r,a,o=this;return e().w(function(e){for(;;)switch(e.n){case 0:return n="ps-media-capture-modal",r={},v.a.copyObject(r,this.options,!0),r.isAdvanced=!0,this.modalController.dismiss(null,null,n),e.n=1,this.modalController.create({component:i,cssClass:n,componentProps:{options:r,lastStateData:this.screenData&&this.screenData.lastStateData?this.screenData.lastStateData:null},backdropDismiss:!0,animated:!1,id:n});case 1:return a=e.v,e.n=2,a.present();case 2:return e.n=3,a.onDidDismiss().then(function(e){o.screenData.lastStateData=e.data}).catch(function(e){return o.common.logger.log(e)});case 3:return e.a(2)}},t,this)}))}},{key:"dismissModal",value:function(e){var t;e?(o(i,"resetFileValController",this,3)([]),this.modalController.dismiss()):(o(i,"setFileValController",this,3)([null===(t=this.screenData)||void 0===t?void 0:t.visibleImagesOnlyArray.filter(function(e){return e.imageBase64Url})]),this.modalController.dismiss(this.screenData,null,"ps-media-capture-modal"))}},{key:"checkSelectedMedia",value:function(e){var t=this;if(e.type==this.TYPE_VIDEO){var n="ps-confirm-close";this.common.presentPsAlert({cssClass:"user-consent-popup",header:"you_will_be_recorded_key",buttons:[{role:"cancel",options:{labelKey:"cancel_key",psClass:"ps-drafts-report-cancel-button",group:this.options.group},handler:function(){v.a.dismissAllModals(null,null,n)}},{options:{labelKey:"ok_key",psClass:"ps-drafts-report-cancel-button",group:this.options.group},handler:function(){v.a.dismissAllModals(null,null,n),t.selectMedia(e)}}]},n)}else this.selectMedia(e)}},{key:"selectMedia",value:function(e){var t=this;this.screenData.currentSelectedImage=e,this.screenData.visibleImagesOnlyArray.forEach(function(n){n.psClass="",n.dynamicID==e.dynamicID?(n.psClass="ps-selected-image",t.screenData.currentSelectedImageID=e.dynamicID):n.psClass=""})}},{key:"createDynID",value:function(e,t){return e.dynamicID=t,t}},{key:"handleMouseEvent",value:function(e){this.onMouseDownFlag=e,this.onMouseDownDrag=e}},{key:"onMouseDown",value:function(e){e.preventDefault(),this.onMouseDownDrag=!0,this.slider&&(this.startX=e.pageX-this.slider.nativeElement.offsetLeft,this.scrollLeft=this.slider.nativeElement.scrollLeft)}},{key:"handleOnMove",value:function(e){this.onMouseDownDrag&&this.slider&&(this.onMouseDownFlag=!0,e.preventDefault(),this.slider.nativeElement.scrollLeft=this.scrollLeft-2*(e.pageX-this.slider.nativeElement.offsetLeft-this.startX))}},{key:"switchCamera",value:function(){this.isWebRTCAvailable?(this.screenData.currentStream.getTracks().forEach(function(e){return e.stop()}),this.screenData.camSide="environment"==this.screenData.camSide?"user":"environment",this.initFlow()):this.cameraPreview.switchCamera()}},{key:"ngOnDestroy",value:function(){this.cameraPreview.stopCamera()}}])}(f.a);return t.\u0275fac=function(e){return new(e||t)(c.Rb(h.a),c.Rb(c.m),c.Rb(c.i),c.Rb(b.N),c.Rb(l.a))},t.\u0275cmp=c.Lb({type:t,selectors:[["ps-complex-media-capture"]],viewQuery:function(e,t){var n;(1&e&&(c.Wc(P,1),c.Wc(k,1),c.Wc(E,1),c.Wc(C,1),c.Wc(S,1,c.m)),2&e)&&(c.Bc(n=c.gc())&&(t.userVideoRef=n.first),c.Bc(n=c.gc())&&(t.userVideoPreview=n.first),c.Bc(n=c.gc())&&(t.slider=n.first),c.Bc(n=c.gc())&&(t.userVideoWrapper=n.first),c.Bc(n=c.gc())&&(t.imagesReference=n))},inputs:{options:"options"},features:[c.Cb],decls:2,vars:2,consts:[[4,"ngIf"],["class","ps-custom-component-preview selfie-component","psPreviewEngine","",4,"ngIf"],["class","widget-style",4,"ngIf"],[1,"media-wrapper",3,"ngClass"],[1,"buttons-wrapper"],["class","col-12",3,"options","onClick",4,"ngIf"],[1,"widget-style"],[1,"widget-menu-icon","widget-menu-icon-back",3,"click"],[1,"modal-close-icon",3,"options"],[1,"media-video-wrapper"],["userVideoWrapper",""],["playsinline","","autoplay","",1,"media-video"],["userVideo",""],["class","source-switcher",3,"options","onClick",4,"ngIf"],["class","media-video-wrapper-preview",3,"ngClass","mousedown","mouseup","mouseleave","mousemove",4,"ngIf"],[1,"source-switcher",3,"options","onClick"],[1,"media-video-wrapper-preview",3,"ngClass","mousedown","mouseup","mouseleave","mousemove"],["slider",""],[4,"ngFor","ngForOf"],[1,"media-image-preview",3,"options","id","click"],["imageReference",""],["playsinline","","autoplay","",1,"media-video-preview",3,"click"],["userVideoPreview",""],[3,"options","ngClass","onClick"],[3,"ngClass","options","onClick",4,"ngIf"],[3,"ngClass","options","onClick"],[1,"col-12",3,"options","onClick"],["psPreviewEngine","",1,"ps-custom-component-preview","selfie-component"],["psPreviewLabel","","class","ps-lbl-preview",3,"id","options",4,"ngIf"],["psPreviewLabel","",1,"ps-lbl-preview",3,"id","options"],["psPreviewHTML","",1,"media-image-preview",3,"options"]],template:function(e,t){1&e&&(c.Pc(0,U,7,8,"ng-container",0),c.Pc(1,x,3,2,"div",1)),2&e&&(c.pc("ngIf",(t.visible||t.custMode)&&!t.previewMode),c.Fb(1),c.pc("ngIf",t.previewMode))},directives:[y.o,y.m,w.a,y.n,D.a,I.a,O.a],encapsulation:2}),t}()}}])}();
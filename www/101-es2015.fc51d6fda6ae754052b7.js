(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{"1Dkv":function(t,e,o){"use strict";o.r(e),o.d(e,"CreditCardSettlementPage",function(){return _});var s=o("3Pt+"),i=o("OVQh"),n=o("/M2N"),c=o("vbr2"),r=o("fOh1"),p=o("0CJq"),l=o("ZyuK"),a=o("f42Q"),u=o("DFXC"),m=o("woXy"),h=o("Q0Ba"),d=o("gKqT"),f=o("zngb"),O=o("fXoL"),b=o("kRg/"),y=o("uKCV"),C=o("sAFK"),g=o("+f2X"),A=o("8I2j"),k=o("VEWP");const x=["toAccountRef"],L=["fromAccountRef"],N=["exchangeRef"];function v(t,e){if(1&t){const t=O.Yb();O.Xb(0,"ps-form-step",2),O.Xb(1,"ps-container-panel",3),O.Xb(2,"ps-lookup-credit-cards",4,5),O.fc("onCreditCardChange",function(e){return O.Fc(t),O.ic().creditCardListChange(e)}),O.Wb(),O.Xb(4,"ps-lookup-own-accounts",6,7),O.fc("onAccountChange",function(e){return O.Fc(t),O.ic().settlementAccountChange(e)}),O.Wb(),O.Sb(6,"ps-complex-exchange",8,9),O.Wb(),O.Wb()}if(2&t){const t=O.ic();O.pc("id",t.stepperOptions.namesofSteps[0]),O.Fb(1),O.pc("options",t.panelOptions1Step1),O.Fb(1),O.pc("options",t.creditCardsLookupOptiops),O.Fb(2),O.pc("options",t.settlementAccountListOptions),O.Fb(2),O.pc("options",t.complexExchangeOptions)}}let _=(()=>{class t extends d.OmniBasePage{constructor(t,e,o,n,p,l,a){super(),this.omniPull=t,this.logger=e,this.nav=o,this.loggerP=n,this.commonService=p,this.omniCommon=l,this.eventEmitterService=a,this.formGroup=new s.f({}),this.creditCardSettlementVO={},this.defaultVO={},this.ownAccountVO={},this.stepperOptions={stepperName:"credit_card_settlement",isHorizontalStepper:!0,numberOfSteps:1,namesofSteps:["credit_card_settlement_step1"],group:this.formGroup,submitOptions:{extraParams:{},submitServiceUrl:r.a.serviceUrl.creditCardSettlementRequestEndPoint,group:this.formGroup},requestObject:this.creditCardSettlementVO},this.panelOptions1Step1={isExpandable:!0,labelKey:"credit_card_settlement_key",iconName:"document",expanded:!0},this.creditCardsLookupOptiops={labelKey:"credit_card_key",placeHolder:"select_credit_card_key",group:this.formGroup,fcName:"creditCard",requestObject:this.creditCardSettlementVO,component:c.a},this.settlementAccountListOptions={labelKey:"settlement_account_key",placeHolder:"settlement_account_key",component:i.a,group:this.formGroup,accountAllowedCurrencies:[],accountAllowedTypes:[],glTypes:"G",fcName:"toAccount",accountType:"G",fromTo:"from",defaultByPersonalizedAcc:!1,requestObject:this.creditCardSettlementVO},this.complexExchangeOptions={editableMode:!1,fromAmountOptions:{currency:"",currenciesOptions:{placeHolder:"currency_key",labelKey:"currency_key",fcName:"fromCurrency",group:this.formGroup},amountOptions:{labelKey:"amount_key",placeHolder:"enter_amount_key",fcName:"transactionAmount",group:this.formGroup,decimalPoints:2}},toAmountOptions:{currency:"",currenciesOptions:{placeHolder:"currency_key",labelKey:"currency_key",fcName:"currency",group:this.formGroup},amountOptions:{labelKey:"exchange_amount_key",placeHolder:"enter_amount_key",fcName:"toAmount",group:this.formGroup,decimalPoints:2}},requestObject:this.creditCardSettlementVO,group:this.formGroup},this.toAccountComponent={}}ngOnInit(){super.init(),this.commonProv.copyObject(this.creditCardSettlementVO,this.nav.getAllParams()?this.nav.getAllParams().ScreenVO?this.nav.getAllParams().ScreenVO:this.nav.getAllParams():{}),this.baseFormGroup=this.formGroup}settlementAccountChange(t){t&&(this.validateCurrencyCombination(t),this.complexExchangeOptions.toAmountOptions.currency=t.currencyCode,this.complexExchangeOptions.toAmountOptions.currencyCode=t.currency,setTimeout(()=>{this.stepperOptions.requestObject[this.complexExchangeOptions.toAmountOptions.currenciesOptions.fcName]=t.currency},1),this.showExchangeRate())}creditCardListChange(t){t&&(this.validateCurrencyCombination(t),this.complexExchangeOptions.fromAmountOptions.currency=t.currencyCode,this.complexExchangeOptions.fromAmountOptions.currencyCode=t.currency,setTimeout(()=>{this.stepperOptions.requestObject[this.complexExchangeOptions.fromAmountOptions.currenciesOptions.fcName]=t.currency},1),this.creditCardSettlementVO.defaultSettlementAccount=null==this.creditCardSettlementVO.defaultSettlementAccount||this.creditCardSettlementVO.defaultSettlementAccount,this.creditCardSettlementVO.defaultSettlementAccount&&(this.commonProv.setValInsideNestedObj(this.settlementAccountListOptions.fcName,t.additionalRef,this.creditCardSettlementVO),this.commonProv.setValInsideNestedObj(this.settlementAccountListOptions.fcName+"_lookupKey",t.additionalRef,this.creditCardSettlementVO)))}showExchangeRate(){this.exchangeChild.showToCurrency()}validateCurrencyCombination(t){t[f.a.VALIDATE_COMBINATION]&&this.creditCardSettlementVO[this.settlementAccountListOptions.fcName]&&this.creditCardSettlementVO[this.creditCardsLookupOptiops.fcName]&&this.creditCardSettlementVO[this.settlementAccountListOptions.fcName].currency!=this.creditCardSettlementVO[this.creditCardsLookupOptiops.fcName].currency&&this.omniPull.validateCurrencyCombination({fromCurrency:+this.creditCardSettlementVO[this.settlementAccountListOptions.fcName].currency,toCurrency:+this.creditCardSettlementVO[this.creditCardsLookupOptiops.fcName].currency,listOfAccounts:[this.fromAccountRef,this.toAccountRef,this.exchangeRef],listOfAffectedFields:[this.complexExchangeOptions.toAmountOptions.currenciesOptions.fcName,this.complexExchangeOptions.fromAmountOptions.currenciesOptions.fcName],screenVO:this.creditCardSettlementVO})}}return t.\u0275fac=function(e){return new(e||t)(O.Rb(l.a),O.Rb(u.a),O.Rb(m.a),O.Rb(u.a),O.Rb(h.a),O.Rb(p.a),O.Rb(a.a))},t.\u0275cmp=O.Lb({type:t,selectors:[["credit-card-settlement"]],viewQuery:function(t,e){if(1&t&&(O.Wc(n.a,1),O.Wc(x,1),O.Wc(L,1),O.Wc(N,1)),2&t){let t;O.Bc(t=O.gc())&&(e.exchangeChild=t.first),O.Bc(t=O.gc())&&(e.toAccountRef=t.first),O.Bc(t=O.gc())&&(e.fromAccountRef=t.first),O.Bc(t=O.gc())&&(e.exchangeRef=t.first)}},features:[O.Cb],decls:2,vars:3,consts:[[3,"options","id"],["step1","",3,"id",4,"psStep"],["step1","",3,"id"],["id","credit_card_req_panel",3,"options"],[3,"options","onCreditCardChange"],["fromAccountRef",""],["id","'transferFrom'+ id",3,"options","onAccountChange"],["toAccountRef",""],[3,"options"],["exchangeRef",""]],template:function(t,e){1&t&&(O.Xb(0,"ps-template-stepper",0),O.Pc(1,v,8,5,"ps-form-step",1),O.Wb()),2&t&&(O.pc("options",e.stepperOptions)("id",e.stepperOptions.stepperName),O.Fb(1),O.pc("psStep","step1"))},directives:[b.a,y.a,C.a,g.a,A.a,k.a,n.a],styles:[""]}),t})()},"8I2j":function(t,e,o){"use strict";o.d(e,"a",function(){return O});var s=o("mrSG"),i=o("fXoL"),n=o("3Pt+"),c=o("GIS6"),r=o("V0Fi"),p=o("ZF3V"),l=o("DFXC"),a=o("zngb"),u=o("Q0Ba"),m=o("vbr2"),h=o("Isd1"),d=o("L0og");const f=["complexLookupComponentObj"];let O=(()=>{class t extends p.a{constructor(t,e,o){super(t,e),this.commonService=t,this.crdsSrvce=o,this.formGroup=new n.f({}),this.options={requestObject:null},this.complexLookupOptions={requestObject:null,notFoundMessage:"no_credit_card_found_key"},this.onCreditCardChange=new i.o,this.labelValuesMap=new Map,this.creditCardRequestParam={}}ngOnInit(){super.init(),this.loadCreditCards(),this.complexLookupOptions.title="title_key",this.complexLookupOptions.subTitle="sub_title_key",this.complexLookupOptions.labelsValueMap=this.labelValuesMap,this.complexLookupOptions.type=c.a.CREDIT_CARD_TYPE_NAME,this.commonProv.copyObject(this.complexLookupOptions,this.options,!1),this.complexLookupOptions.requestObject=this.options.requestObject,this.complexLookupOptions.component=this.options&&this.options.component?this.options.component:m.a}loadCreditCards(){this.creditCardRequestParam={};const t=this.commonProv.session.getValueOf(a.a.USERINFO);this.creditCardRequestParam.vsBranchCode=t.cifBranch,this.creditCardRequestParam.cardType=r.a.CARD_SEGMENT_NAME_CREDIT,this.options&&void 0!==this.options.submitType&&(this.creditCardRequestParam.submitType=this.options.submitType),this.returnCreditCards(this.creditCardRequestParam)}returnCreditCards(t){return Object(s.b)(this,void 0,void 0,function*(){const e=yield this.crdsSrvce.returnCardList(t).catch(t=>{this.complexLookupOptions.listOfOptions=[],this.logger.error("Error: While fetching credits cards in PsLookupCreditCardsComponent :",t)});this.complexLookupOptions.listOfOptions=e&&e.gridModel.length>0?this.populateCreditCards(e.gridModel):[]})}onChangeItem(t){this.onCreditCardChange.emit(t)}populateCreditCards(t){const e=t.filter(t=>t.statusCode==r.a.CARD_STATUS_ACTIVE_CODE);return this.crdsSrvce.populateCards(e,c.a.CREDIT_CARD_TYPE_NAME)}reset(){this.complexLookupComponentObj.resetLookUp()}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(u.a),i.Rb(l.a),i.Rb(c.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["ps-lookup-credit-cards"]],viewQuery:function(t,e){if(1&t&&i.Wc(f,1),2&t){let t;i.Bc(t=i.gc())&&(e.complexLookupComponentObj=t.first)}},inputs:{options:"options"},outputs:{onCreditCardChange:"onCreditCardChange"},features:[i.Cb],decls:3,vars:2,consts:[[1,"ps-lookup-credit-cards"],[3,"id","options","changeItem"],["complexLookupComponentObj",""]],template:function(t,e){1&t&&(i.Xb(0,"ps-container-complex",0),i.Xb(1,"ps-complex-lookup",1,2),i.fc("changeItem",function(t){return e.onChangeItem(t)}),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.pc("id",e.id)("options",e.complexLookupOptions))},directives:[h.a,d.a],styles:[""]}),t})()},VEWP:function(t,e,o){"use strict";o.d(e,"a",function(){return O});var s=o("mrSG"),i=o("fXoL"),n=o("4lGw"),c=o("V0Fi"),r=o("ZyuK"),p=o("ZF3V"),l=o("EIUR"),a=o("DFXC"),u=o("zngb"),m=o("Q0Ba"),h=o("Isd1"),d=o("L0og");const f=["complexLookupComponentObj"];let O=(()=>{class t extends p.a{constructor(t,e,o,s){super(t,e),this.commonService=t,this.omniPull=o,this.accountsService=s,this.options={fromTo:"",requestObject:null},this.complexLookupOptions={requestObject:null,notFoundMessage:"no_valid_account_found_key",multiple:!!this.options.multiple&&this.options.multiple},this.onAccountChange=new i.o,this.onAccountDeleted=new i.o,this.labelValuesMap=new Map,this.psCurrency=new l.a,this.labelOptions={},this.allType=!1}ngOnInit(){this.loadAccounts(null),this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.title="title_key",this.complexLookupOptions.subTitle="sub_title_key",this.complexLookupOptions.labelsValueMap=this.labelValuesMap,this.allType=!!this.options.allType&&this.options.allType,this.commonProv.copyObject(this.complexLookupOptions,this.options,!1),this.complexLookupOptions.requestObject=this.options.requestObject}ngOnChanges(t){this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.placeHolder=this.options.placeHolder}loadAccounts(t){return Object(s.b)(this,void 0,void 0,function*(){if(null!=t&&(this.options=t),this.options.listOfAccounts=[],void 0===this.options.fromTo||""===this.options.fromTo)return void this.logger.error("lookup_from_to_missing_key");const e=this.commonService.session.getValueOf(u.a.USERINFO),o=this.prepareRequestData(e);this.returnAccountList(o)})}returnAccountList(t){return Object(s.b)(this,void 0,void 0,function*(){const e=this.commonProv.session.getValueOf(c.a.PERSONALIZATION_CO);this.complexLookupOptions.listOfOptions=void 0;const o=yield this.omniPull.returnAccounts(t).catch(t=>{this.complexLookupOptions.listOfOptions=[],this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",t)});if(o&&o.gridModel.length>0){if(this.allType){t.accountType="F",t.permittedGls="F";const e=yield this.omniPull.returnAccounts(t).catch(t=>{this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",t)});e&&e.gridModel.length>0&&(o.gridModel=[...o.gridModel,...e.gridModel])}if(this.options.listOfAccounts=o.gridModel,this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(t=>t.accountNumber!==this.options.accountNumber)),this.options.currency&&""!==this.options.currency&&(this.complexLookupOptions.listOfOptions=this.fetchAccountBasedOnCurrency(this.options.currency),this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(t=>t.accountNumber!==this.options.accountNumber))),null!=this.options.accountNumber&&""!==this.options.accountNumber||(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts),this.complexLookupOptions.listOfOptions=this.populateCustomAccounts(this.complexLookupOptions.listOfOptions),this.complexLookupOptions.listOfOptions.map((t,e)=>t.rowIndex=e),this.allAccounts=Object.assign([],this.complexLookupOptions.listOfOptions),null==this.complexLookupOptions.selectedItems&&(this.complexLookupOptions.selectedItems=[]),this.complexLookupOptions.multiple&&this.handleMultipleSelection(),!this.options.requestObject[this.options.fcName]&&(this.options.defaultByPersonalizedAcc=null==this.options.defaultByPersonalizedAcc||this.options.defaultByPersonalizedAcc,"from"===this.options.fromTo&&this.options.defaultByPersonalizedAcc)){let t="QR"===this.options.purpose?null==e?void 0:e.defaultQrPaymentAccKey:null==e?void 0:e.defaultTransferAccKey;this.complexLookupOptions.listOfOptions.map(e=>{e.personalizeKey&&e.personalizeKey===t&&(this.common.setValInsideNestedObj(this.options.fcName,e.lookupKey,this.options.requestObject),this.common.setValInsideNestedObj(this.options.fcName+"_lookupKey",e.lookupKey,this.options.requestObject))})}}else this.listOfAccounts=[],this.complexLookupOptions.listOfOptions=[]})}populateCustomAccounts(t){const e=[];for(const o of t){const t={briefNameEnglish:o.briefNameEnglish,cifShortNameEnglish:o.cifShortNameEnglish,accountNumber:o.accountNumber,balance:this.psCurrency.transform(null==o.balance?"0.0":o.balance,o.currencyDecimalPoints)+" "+(o.currencyBriefName||o.currencyBriefNameEnglish),availableBalance:this.psCurrency.transform(null==o.availableBalance?"0.0":o.availableBalance,o.currencyDecimalPoints)+" "+(o.currencyBriefName||o.currencyBriefNameEnglish),currencyBriefName:o.currencyBriefName||o.currencyBriefNameEnglish,currencyBriefNameEnglish:o.currencyBriefNameEnglish,currency:o.currency,accountTypeDesc:o.accountTypeDesc,additionalRef:o.additionalRef,ibanAccNo:o.ibanAccNo,accGl:o.accGl,serialNo:o.serialNo,branch:o.branch,cif:o.cif,formattedAccount:this.accountsService.returnFormattedAccount(o).formattedAccount,personalizeKey:o.personalizeKey,nickName:o.nickName,briefName:o.briefName,lookupKey:o.additionalRef,branchDescription:o.branchDescription?o.branchDescription:"",generalLedgerBriefNameEng:o.generalLedgerBriefNameEng?o.generalLedgerBriefNameEng:"",previewProperty:"accountNumber",status:o.statusDescription,statusCode:o.status,accountFormat:this.accountsService.returnFormattedAccount(o).accountFormat};this.options.multiple&&(t.excludeType=o.excludeType),e.push(t)}return e}prepareRequestData(t){let e={};if(t&&t.omniUserVO&&(e={userCifNo:t.omniUserVO.CIF_NO,type:"A"}),null!=this.options.queryParams&&void 0!==this.options.queryParams&&""!==this.options.queryParams&&(e={commonParametersList:this.options.queryParams}),null!=this.options.accountType&&void 0!==this.options.accountType&&""!==this.options.accountType&&(e.accountType=this.options.accountType),null!=this.options.glTypes&&void 0!==this.options.glTypes&&""!==this.options.glTypes&&(e.permittedGls=this.options.glTypes),null!=this.options.fromTo&&""!==this.options.fromTo&&(e.fromTo=this.options.fromTo),null!=this.options.endUserId&&""!==this.options.endUserId&&(e.endUserId=this.options.endUserId),null!=this.options.fromCurrency?e.fromCurrency=this.options.fromCurrency:null!=this.options.toCurrency&&(e.toCurrency=this.options.toCurrency),null!=this.options.accountAllowedCurrencies&&void 0!==this.options.accountAllowedCurrencies)if("string"==typeof this.options.accountAllowedCurrencies)e.accountAllowedCurrencies=this.options.accountAllowedCurrencies;else{let t="";for(const e in this.options.accountAllowedCurrencies)t+=this.options.accountAllowedCurrencies[e]+",";t=t.slice(0,t.lastIndexOf(",")),e.accountAllowedCurrencies=t}if(null!=this.options.accountAllowedTypes&&void 0!==this.options.accountAllowedTypes)if("string"==typeof this.options.accountAllowedTypes)e.accountAllowedTypes=this.options.accountAllowedTypes;else{let t="";for(const e in this.options.accountAllowedTypes)t+=this.options.accountAllowedTypes[e]+",";t=t.slice(0,t.lastIndexOf(",")),e.accountAllowedTypes=t}return e}fetchAccountBasedOnCurrency(t){return this.options.listOfAccounts}onChange(t){this.logger.log(t)}populateOwnAccountMap(){let t={},e={},o={};t={key:"accountNumber",value:"--- --- --- ---",isEdit:!1},e={key:"currentBalance",value:"0.0",isEdit:!1},o={key:"availableBalance",value:"0.0",isEdit:!1},this.labelValuesMap.set("account_key",t),this.labelValuesMap.set("balance_key",e),this.labelValuesMap.set("available_balance_key",o)}onChangeItem(t){this.onAccountChange.emit(t)}onDeleteItem(t){t&&this.onAccountDeleted.emit(t)}handleMultipleSelection(){const t=this.options.setAllAccountsAsSelecetd?this.complexLookupOptions.listOfOptions:this.options.requestObject[this.options.fcName]?this.complexLookupOptions.listOfOptions.filter(t=>this.options.requestObject[this.options.fcName].some(e=>e.accountNumber==t.accountNumber)):[];this.complexLookupOptions.selectedItems=t.filter(t=>this.options.setAllAccountsAsSelecetd&&(!t.excludeType||!(t.excludeType.includes(c.a.GENERAL_ACCOUNT_EXCLUDE_TYPE)||t.excludeType.includes(c.a.TERM_ACCOUNT_EXCLUDE_TYPE)))||!this.options.setAllAccountsAsSelecetd).map(t=>Object.assign(Object.assign({item:t[t.previewProperty]},t),{itemLookup:t.lookupKey})),this.complexLookupOptions.selectedItems.length>0&&this.complexLookupComponentObj.setSelectedItems(this.complexLookupOptions.selectedItems)}removeAccount(t){t&&void 0!==this.allAccounts&&(this.complexLookupOptions.listOfOptions=this.allAccounts?this.allAccounts.filter(e=>t.accountNumber!=e.accountNumber):[])}reset(){this.complexLookupComponentObj.resetLookUp()}refreshAcounts(t){this.complexLookupOptions.listOfOptions=Object.assign([],this.allAccounts),this.removeAccount(t)}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(m.a),i.Rb(a.a),i.Rb(r.a),i.Rb(n.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["ps-lookup-own-accounts"]],viewQuery:function(t,e){if(1&t&&i.Wc(f,1),2&t){let t;i.Bc(t=i.gc())&&(e.complexLookupComponentObj=t.first)}},inputs:{options:"options"},outputs:{onAccountChange:"onAccountChange",onAccountDeleted:"onAccountDeleted"},features:[i.Cb,i.Db],decls:3,vars:2,consts:[[1,"ps-complex-own-account"],[3,"id","options","changeItem","onDeleteItem"],["complexLookupComponentObj",""]],template:function(t,e){1&t&&(i.Xb(0,"ps-container-complex",0),i.Xb(1,"ps-complex-lookup",1,2),i.fc("changeItem",function(t){return e.onChangeItem(t)})("onDeleteItem",function(t){return e.onDeleteItem(t)}),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.pc("id",e.id)("options",e.complexLookupOptions))},directives:[h.a,d.a],styles:[""]}),t})()}}]);
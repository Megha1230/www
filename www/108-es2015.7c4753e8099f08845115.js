(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{"0tdU":function(e,o,t){"use strict";t.r(o),t.d(o,"POSRequestPage",function(){return _});var s=t("3Pt+"),i=t("OVQh"),n=t("fOh1"),c=t("DFXC"),p=t("zngb"),l=t("Q0Ba"),r=t("gKqT"),a=t("fXoL"),u=t("kRg/"),h=t("uKCV"),m=t("sAFK"),d=t("+f2X"),f=t("VEWP"),O=t("WAnK"),b=t("KuXP"),y=t("ofXK"),g=t("/QlS");function A(e,o){1&e&&a.Sb(0,"ps-input-varchar",9),2&e&&a.pc("options",o.$implicit)}function k(e,o){if(1&e){const e=a.Yb();a.Xb(0,"ps-form-step",2),a.Xb(1,"ps-container-panel",3),a.Sb(2,"ps-lookup-own-accounts",4,5),a.Xb(4,"ps-input-numeric",6),a.fc("onPsChange",function(o){return a.Fc(e),a.ic().onChangeNumberOfPos(o)}),a.Wb(),a.Sb(5,"ps-select-toggle",7),a.Pc(6,A,1,1,"ps-input-varchar",8),a.Wb(),a.Wb()}if(2&e){const e=a.ic();a.pc("id",e.stepperOptions.namesofSteps[0]),a.Fb(1),a.pc("options",e.mainDetailsOptions),a.Fb(1),a.pc("options",e.accountOptions),a.Fb(2),a.pc("options",e.numberOfPosOptions),a.Fb(1),a.pc("id","sameBankBenef")("options",e.emailNotificationOptions),a.Fb(1),a.pc("ngForOf",e.slipHeaderLabelValues)}}let _=(()=>{class e extends r.OmniBasePage{constructor(e,o){super(),this.commonService=e,this.logger=o,this.formGroup=new s.f({}),this.posRequestVO={},this.stepperOptions={stepperName:"pos_request_key",isHorizontalStepper:!0,numberOfSteps:1,namesofSteps:["pos_request_key"],group:this.formGroup,submitOptions:{submitServiceUrl:n.a.serviceUrl.POSRequest,group:this.formGroup},requestObject:this.posRequestVO},this.mainDetailsOptions={isExpandable:!0,labelKey:"main_details_key",expanded:!0,iconName:"contact"},this.accountOptions={labelKey:"account_number_key",placeHolder:"account_number_key",component:i.a,group:this.formGroup,accountAllowedCurrencies:[],accountAllowedTypes:[],glTypes:"G",fcName:"accountNo",accountType:"G",fromTo:"to",requestObject:this.posRequestVO},this.numberOfPosOptions={group:this.formGroup,fcName:"numberOfPOS",placeHolder:"number_of_pos_key",labelKey:"number_of_pos_key",forceTriggerChange:!0},this.emailNotificationOptions={labelKey:"email_notification_key",group:this.formGroup,fcName:"emailAlert",psClass:"toggleColor"},this.slipHeaderOptions={labelKey:"slip_header_key",placeHolder:"slip_header_key",group:this.formGroup,fcName:"slipHeader"},this.slipHeaderLabelValues=[],this.businessOccupationCodeOptions={group:this.formGroup,fcName:"businessOccupationCode",labelKey:"business_occupation_code_key",placeHolder:"enter_business_occupation_key"},this.merchantCategoryCodeOptions={group:this.formGroup,fcName:"mccCode",labelKey:"merchant_category_code_key",placeHolder:"enter_merchant_category_code_key"},this.stateCodeOptions={group:this.formGroup,fcName:"stateCode",labelKey:"state_code_key",placeHolder:"enter_state_code_key"},this.localGovtAreaCodeOptions={group:this.formGroup,fcName:"lga",labelKey:"locat_govt_area_code_key",placeHolder:"enter_locat_govt_area_code_key"}}ngOnInit(){}ionViewDidEnter(){super.ionViewDidEnter(),this.commonProv.applyDynScreenDisplay(p.a.ACTION_TYPE_MANDATORY,[this.emailNotificationOptions.fcName],0)}onChangeNumberOfPos(e){this.slipHeaderLabelValues=[];for(let o=1;o<=e.newValue;o++)this.slipHeaderLabelValues.push({labelKey:1==e.newValue?"slip_header_key":"slip_header_key["+o+"] of ["+e.newValue+"]",placeHolder:"slip_header_key",group:this.formGroup,fcName:"slipHeader"+o.toString()})}}return e.\u0275fac=function(o){return new(o||e)(a.Rb(l.a),a.Rb(c.a))},e.\u0275cmp=a.Lb({type:e,selectors:[["pos-request"]],features:[a.Cb],decls:2,vars:3,consts:[[3,"options","id"],["step1","",3,"id",4,"psStep"],["step1","",3,"id"],["id","main_details_panel",3,"options"],["id","'transferFrom'+ id",3,"options"],["fromAccountRef",""],[3,"options","onPsChange"],[3,"id","options"],[3,"options",4,"ngFor","ngForOf"],[3,"options"]],template:function(e,o){1&e&&(a.Xb(0,"ps-template-stepper",0),a.Pc(1,k,7,7,"ps-form-step",1),a.Wb()),2&e&&(a.pc("options",o.stepperOptions)("id",o.stepperOptions.stepperName),a.Fb(1),a.pc("psStep","step1"))},directives:[u.a,h.a,m.a,d.a,f.a,O.a,b.a,y.n,g.a],styles:[""]}),e})()},VEWP:function(e,o,t){"use strict";t.d(o,"a",function(){return O});var s=t("mrSG"),i=t("fXoL"),n=t("4lGw"),c=t("V0Fi"),p=t("ZyuK"),l=t("ZF3V"),r=t("EIUR"),a=t("DFXC"),u=t("zngb"),h=t("Q0Ba"),m=t("Isd1"),d=t("L0og");const f=["complexLookupComponentObj"];let O=(()=>{class e extends l.a{constructor(e,o,t,s){super(e,o),this.commonService=e,this.omniPull=t,this.accountsService=s,this.options={fromTo:"",requestObject:null},this.complexLookupOptions={requestObject:null,notFoundMessage:"no_valid_account_found_key",multiple:!!this.options.multiple&&this.options.multiple},this.onAccountChange=new i.o,this.onAccountDeleted=new i.o,this.labelValuesMap=new Map,this.psCurrency=new r.a,this.labelOptions={},this.allType=!1}ngOnInit(){this.loadAccounts(null),this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.title="title_key",this.complexLookupOptions.subTitle="sub_title_key",this.complexLookupOptions.labelsValueMap=this.labelValuesMap,this.allType=!!this.options.allType&&this.options.allType,this.commonProv.copyObject(this.complexLookupOptions,this.options,!1),this.complexLookupOptions.requestObject=this.options.requestObject}ngOnChanges(e){this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.placeHolder=this.options.placeHolder}loadAccounts(e){return Object(s.b)(this,void 0,void 0,function*(){if(null!=e&&(this.options=e),this.options.listOfAccounts=[],void 0===this.options.fromTo||""===this.options.fromTo)return void this.logger.error("lookup_from_to_missing_key");const o=this.commonService.session.getValueOf(u.a.USERINFO),t=this.prepareRequestData(o);this.returnAccountList(t)})}returnAccountList(e){return Object(s.b)(this,void 0,void 0,function*(){const o=this.commonProv.session.getValueOf(c.a.PERSONALIZATION_CO);this.complexLookupOptions.listOfOptions=void 0;const t=yield this.omniPull.returnAccounts(e).catch(e=>{this.complexLookupOptions.listOfOptions=[],this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",e)});if(t&&t.gridModel.length>0){if(this.allType){e.accountType="F",e.permittedGls="F";const o=yield this.omniPull.returnAccounts(e).catch(e=>{this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",e)});o&&o.gridModel.length>0&&(t.gridModel=[...t.gridModel,...o.gridModel])}if(this.options.listOfAccounts=t.gridModel,this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(e=>e.accountNumber!==this.options.accountNumber)),this.options.currency&&""!==this.options.currency&&(this.complexLookupOptions.listOfOptions=this.fetchAccountBasedOnCurrency(this.options.currency),this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(e=>e.accountNumber!==this.options.accountNumber))),null!=this.options.accountNumber&&""!==this.options.accountNumber||(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts),this.complexLookupOptions.listOfOptions=this.populateCustomAccounts(this.complexLookupOptions.listOfOptions),this.complexLookupOptions.listOfOptions.map((e,o)=>e.rowIndex=o),this.allAccounts=Object.assign([],this.complexLookupOptions.listOfOptions),null==this.complexLookupOptions.selectedItems&&(this.complexLookupOptions.selectedItems=[]),this.complexLookupOptions.multiple&&this.handleMultipleSelection(),!this.options.requestObject[this.options.fcName]&&(this.options.defaultByPersonalizedAcc=null==this.options.defaultByPersonalizedAcc||this.options.defaultByPersonalizedAcc,"from"===this.options.fromTo&&this.options.defaultByPersonalizedAcc)){let e="QR"===this.options.purpose?null==o?void 0:o.defaultQrPaymentAccKey:null==o?void 0:o.defaultTransferAccKey;this.complexLookupOptions.listOfOptions.map(o=>{o.personalizeKey&&o.personalizeKey===e&&(this.common.setValInsideNestedObj(this.options.fcName,o.lookupKey,this.options.requestObject),this.common.setValInsideNestedObj(this.options.fcName+"_lookupKey",o.lookupKey,this.options.requestObject))})}}else this.listOfAccounts=[],this.complexLookupOptions.listOfOptions=[]})}populateCustomAccounts(e){const o=[];for(const t of e){const e={briefNameEnglish:t.briefNameEnglish,cifShortNameEnglish:t.cifShortNameEnglish,accountNumber:t.accountNumber,balance:this.psCurrency.transform(null==t.balance?"0.0":t.balance,t.currencyDecimalPoints)+" "+(t.currencyBriefName||t.currencyBriefNameEnglish),availableBalance:this.psCurrency.transform(null==t.availableBalance?"0.0":t.availableBalance,t.currencyDecimalPoints)+" "+(t.currencyBriefName||t.currencyBriefNameEnglish),currencyBriefName:t.currencyBriefName||t.currencyBriefNameEnglish,currencyBriefNameEnglish:t.currencyBriefNameEnglish,currency:t.currency,accountTypeDesc:t.accountTypeDesc,additionalRef:t.additionalRef,ibanAccNo:t.ibanAccNo,accGl:t.accGl,serialNo:t.serialNo,branch:t.branch,cif:t.cif,formattedAccount:this.accountsService.returnFormattedAccount(t).formattedAccount,personalizeKey:t.personalizeKey,nickName:t.nickName,briefName:t.briefName,lookupKey:t.additionalRef,branchDescription:t.branchDescription?t.branchDescription:"",generalLedgerBriefNameEng:t.generalLedgerBriefNameEng?t.generalLedgerBriefNameEng:"",previewProperty:"accountNumber",status:t.statusDescription,statusCode:t.status,accountFormat:this.accountsService.returnFormattedAccount(t).accountFormat};this.options.multiple&&(e.excludeType=t.excludeType),o.push(e)}return o}prepareRequestData(e){let o={};if(e&&e.omniUserVO&&(o={userCifNo:e.omniUserVO.CIF_NO,type:"A"}),null!=this.options.queryParams&&void 0!==this.options.queryParams&&""!==this.options.queryParams&&(o={commonParametersList:this.options.queryParams}),null!=this.options.accountType&&void 0!==this.options.accountType&&""!==this.options.accountType&&(o.accountType=this.options.accountType),null!=this.options.glTypes&&void 0!==this.options.glTypes&&""!==this.options.glTypes&&(o.permittedGls=this.options.glTypes),null!=this.options.fromTo&&""!==this.options.fromTo&&(o.fromTo=this.options.fromTo),null!=this.options.endUserId&&""!==this.options.endUserId&&(o.endUserId=this.options.endUserId),null!=this.options.fromCurrency?o.fromCurrency=this.options.fromCurrency:null!=this.options.toCurrency&&(o.toCurrency=this.options.toCurrency),null!=this.options.accountAllowedCurrencies&&void 0!==this.options.accountAllowedCurrencies)if("string"==typeof this.options.accountAllowedCurrencies)o.accountAllowedCurrencies=this.options.accountAllowedCurrencies;else{let e="";for(const o in this.options.accountAllowedCurrencies)e+=this.options.accountAllowedCurrencies[o]+",";e=e.slice(0,e.lastIndexOf(",")),o.accountAllowedCurrencies=e}if(null!=this.options.accountAllowedTypes&&void 0!==this.options.accountAllowedTypes)if("string"==typeof this.options.accountAllowedTypes)o.accountAllowedTypes=this.options.accountAllowedTypes;else{let e="";for(const o in this.options.accountAllowedTypes)e+=this.options.accountAllowedTypes[o]+",";e=e.slice(0,e.lastIndexOf(",")),o.accountAllowedTypes=e}return o}fetchAccountBasedOnCurrency(e){return this.options.listOfAccounts}onChange(e){this.logger.log(e)}populateOwnAccountMap(){let e={},o={},t={};e={key:"accountNumber",value:"--- --- --- ---",isEdit:!1},o={key:"currentBalance",value:"0.0",isEdit:!1},t={key:"availableBalance",value:"0.0",isEdit:!1},this.labelValuesMap.set("account_key",e),this.labelValuesMap.set("balance_key",o),this.labelValuesMap.set("available_balance_key",t)}onChangeItem(e){this.onAccountChange.emit(e)}onDeleteItem(e){e&&this.onAccountDeleted.emit(e)}handleMultipleSelection(){const e=this.options.setAllAccountsAsSelecetd?this.complexLookupOptions.listOfOptions:this.options.requestObject[this.options.fcName]?this.complexLookupOptions.listOfOptions.filter(e=>this.options.requestObject[this.options.fcName].some(o=>o.accountNumber==e.accountNumber)):[];this.complexLookupOptions.selectedItems=e.filter(e=>this.options.setAllAccountsAsSelecetd&&(!e.excludeType||!(e.excludeType.includes(c.a.GENERAL_ACCOUNT_EXCLUDE_TYPE)||e.excludeType.includes(c.a.TERM_ACCOUNT_EXCLUDE_TYPE)))||!this.options.setAllAccountsAsSelecetd).map(e=>Object.assign(Object.assign({item:e[e.previewProperty]},e),{itemLookup:e.lookupKey})),this.complexLookupOptions.selectedItems.length>0&&this.complexLookupComponentObj.setSelectedItems(this.complexLookupOptions.selectedItems)}removeAccount(e){e&&void 0!==this.allAccounts&&(this.complexLookupOptions.listOfOptions=this.allAccounts?this.allAccounts.filter(o=>e.accountNumber!=o.accountNumber):[])}reset(){this.complexLookupComponentObj.resetLookUp()}refreshAcounts(e){this.complexLookupOptions.listOfOptions=Object.assign([],this.allAccounts),this.removeAccount(e)}}return e.\u0275fac=function(o){return new(o||e)(i.Rb(h.a),i.Rb(a.a),i.Rb(p.a),i.Rb(n.a))},e.\u0275cmp=i.Lb({type:e,selectors:[["ps-lookup-own-accounts"]],viewQuery:function(e,o){if(1&e&&i.Wc(f,1),2&e){let e;i.Bc(e=i.gc())&&(o.complexLookupComponentObj=e.first)}},inputs:{options:"options"},outputs:{onAccountChange:"onAccountChange",onAccountDeleted:"onAccountDeleted"},features:[i.Cb,i.Db],decls:3,vars:2,consts:[[1,"ps-complex-own-account"],[3,"id","options","changeItem","onDeleteItem"],["complexLookupComponentObj",""]],template:function(e,o){1&e&&(i.Xb(0,"ps-container-complex",0),i.Xb(1,"ps-complex-lookup",1,2),i.fc("changeItem",function(e){return o.onChangeItem(e)})("onDeleteItem",function(e){return o.onDeleteItem(e)}),i.Wb(),i.Wb()),2&e&&(i.Fb(1),i.pc("id",o.id)("options",o.complexLookupOptions))},directives:[m.a,d.a],styles:[""]}),e})()}}]);
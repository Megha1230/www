(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{"Evj/":function(o,e,t){"use strict";t.r(e),t.d(e,"RequestQrPaymentPage",function(){return C});var s=t("3Pt+"),n=t("OVQh"),i=t("V0Fi"),c=t("ZyuK"),p=t("DFXC"),r=t("zngb"),a=t("QZhd"),l=t("Q0Ba"),u=t("gKqT"),m=t("fXoL"),h=t("kRg/"),O=t("uKCV"),f=t("sAFK"),d=t("+f2X"),y=t("VEWP"),b=t("G/Qj"),A=t("/QlS"),g=t("/M2N");function N(o,e){if(1&o){const o=m.Yb();m.Xb(0,"ps-form-step",2),m.Xb(1,"ps-container-panel",3),m.Sb(2,"ps-lookup-own-accounts",4),m.Sb(3,"ps-complex-amount",5),m.Sb(4,"ps-input-varchar",6),m.Wb(),m.Xb(5,"ps-container-panel",7),m.Sb(6,"ps-complex-exchange",8),m.Xb(7,"ps-lookup-own-accounts",9),m.fc("onAccountChange",function(e){return m.Fc(o),m.ic().onChargesAccountChange(e)}),m.Wb(),m.Wb(),m.Wb()}if(2&o){const o=m.ic();m.pc("id",o.stepperOptions.namesofSteps[0]),m.Fb(1),m.pc("options",o.qrCodeDetailsPanelOptions),m.Fb(1),m.pc("options",o.accountNoOptions),m.Fb(1),m.pc("options",o.qrComplexAmountOption),m.Fb(1),m.pc("options",o.purposeOptions),m.Fb(1),m.pc("options",o.qrCodeChargesPanelOptions),m.Fb(1),m.pc("options",o.complexExchangeOptions),m.Fb(1),m.pc("options",o.chargesAccountListOptions)}}let C=(()=>{class o extends u.OmniBasePage{constructor(o,e,t){super(),this.commonService=o,this.logger=e,this.omniPull=t,this.formGroup=new s.f({}),this.qrCodeVO={},this.stepperOptions={stepperName:"request_qr_stepper",isHorizontalStepper:!0,numberOfSteps:1,namesofSteps:["request_qr_code_step1"],group:this.formGroup,submitOptions:{group:this.formGroup,submitServiceUrl:"",preCallFunction:{func(o){return new Promise((e,t)=>{e(this.executionClass.generateQRCode(o))})},executionClass:this,params:[this]},extraParams:{actionType:"save"}},requestObject:this.qrCodeVO},this.qrCodeDetailsPanelOptions={isExpandable:!0,labelKey:"qr_code_details_key",expanded:!0},this.qrCodeChargesPanelOptions={isExpandable:!0,labelKey:"qr_code_charges_key",expanded:!0},this.accountNoOptions={labelKey:"account_no_key",placeHolder:"select_account_key",component:n.a,group:this.formGroup,accountAllowedCurrencies:[],accountAllowedTypes:[],glTypes:"G",fcName:"fromAccount",accountType:"G",fromTo:"from",purpose:"QR",requestObject:this.qrCodeVO},this.qrComplexAmountOption={currenciesOptions:{labelKey:"currency_key",placeHolder:"currency_key",group:this.formGroup,fcName:"qrCurrency"},amountOptions:{labelKey:"amount_key",placeHolder:"enter_amount_key",fcName:"transactionAmount",group:this.formGroup,decimalPoints:3}},this.purposeOptions={labelKey:"purpose_key",placeHolder:"enter_purpose_key",group:this.formGroup,fcName:"purpose"},this.chargesAccountListOptions={labelKey:"charges_account_key",placeHolder:"select_charges_account_key",component:n.a,group:this.formGroup,accountAllowedCurrencies:[],accountAllowedTypes:[],glTypes:"G",fcName:"chargesAccount",accountType:"G",fromTo:null,requestObject:this.qrCodeVO,currency:""},this.complexExchangeOptions={editableMode:!1,showToCurrencyOptions:!0,fromAmountOptions:{currency:"",currenciesOptions:{placeHolder:"currency_key",labelKey:"currency_key",fcName:"fromCurrency",group:this.formGroup},amountOptions:{labelKey:"charges_amount_key",placeHolder:"enter_charges_amount_key",fcName:"chargesAmount",group:this.formGroup,decimalPoints:2}},toAmountOptions:{currency:"",currenciesOptions:{placeHolder:"currency_key",labelKey:"exchange_currency_key",fcName:"currency",group:this.formGroup},amountOptions:{labelKey:"exchange_amount_key",placeHolder:"enter_amount_key",fcName:"toAmount",group:this.formGroup,decimalPoints:2}},requestObject:this.qrCodeVO,group:this.formGroup}}ngOnInit(){super.init(),this.cifInfo=this.commonProv.session.getValueOf(r.a.USERINFO),this.commonProv.cancelClicked.next(!1),this.omniPull.getParamValOf(i.a.QR_CHARGES_AMOUNT).then(o=>{o&&o[i.a.QR_CHARGES_AMOUNT]&&(this.commonProv.setValInsideNestedObj(this.complexExchangeOptions.fromAmountOptions.amountOptions.fcName,o[i.a.QR_CHARGES_AMOUNT],this.qrCodeVO),this.stepperOptions.requestObject[this.complexExchangeOptions.fromAmountOptions.amountOptions.fcName]=o[i.a.QR_CHARGES_AMOUNT])}),this.commonProv.setValInsideNestedObj(this.complexExchangeOptions.fromAmountOptions.currenciesOptions.fcName,this.cifInfo.companySettingsCO.baseCurrency,this.qrCodeVO),setTimeout(()=>{this.stepperOptions.requestObject[this.complexExchangeOptions.fromAmountOptions.currenciesOptions.fcName]=this.cifInfo.companySettingsCO.baseCurrency},1),this.commonProv.cancelClicked.subscribe(o=>{o&&this.navigationServices.navigateBackward()})}ionViewDidEnter(){super.ionViewDidEnter(),this.commonProv.applyDynScreenDisplay(r.a.ACTION_TYPE_MANDATORY,[this.purposeOptions.fcName],0),this.commonProv.applyDynScreenDisplay(r.a.ACTION_TYPE_READONLY,[this.complexExchangeOptions.fromAmountOptions.currenciesOptions.fcName],1),this.commonProv.applyDynScreenDisplay(r.a.ACTION_TYPE_READONLY,[this.complexExchangeOptions.fromAmountOptions.amountOptions.fcName],1),this.commonProv.applyDynScreenDisplay(r.a.ACTION_TYPE_MANDATORY,[this.complexExchangeOptions.fromAmountOptions.amountOptions.fcName],0),this.commonProv.applyDynScreenDisplay(r.a.ACTION_TYPE_READONLY,[this.complexExchangeOptions.toAmountOptions.currenciesOptions.fcName],1),this.commonProv.applyDynScreenDisplay(r.a.ACTION_TYPE_READONLY,[this.complexExchangeOptions.toAmountOptions.amountOptions.fcName],1)}onChargesAccountChange(o){this.complexExchangeOptions.toAmountOptions.currency=o.currencyBriefNameEnglish,this.complexExchangeOptions.toAmountOptions.currencyCode=o.currency,setTimeout(()=>{this.stepperOptions.requestObject[this.complexExchangeOptions.toAmountOptions.currenciesOptions.fcName]=o.currency},1)}generateQRCode(o){const e={AccountRef:this.formGroup.controls[this.accountNoOptions.fcName].value.accountFormat+"-"+this.formGroup.controls[this.accountNoOptions.fcName].value.formattedAccount,AddtionalRef:"AddRef-"+this.formGroup.controls[this.accountNoOptions.fcName].value.additionalRef,purposeTxtDesc:this.formGroup.controls[this.purposeOptions.fcName].value,transactionAmount:this.formGroup.controls[this.qrComplexAmountOption.amountOptions.fcName].value,currency:this.formGroup.controls[this.qrComplexAmountOption.currenciesOptions.fcName].value,showToOtherDetails:!0,toAccountType:"companyAccountTransfer",changeScannedDataToRO:!0};this.logger.log("this.stepperOptions.requestObject",this.stepperOptions.requestObject),this.commonService.generateQRCode(e,i.a.QR_CODE_GENERATION_OPER_ID)}updateVO(o){a.a.oper_ID=i.a.QR_CODE_GENERATION_OPER_ID}}return o.\u0275fac=function(e){return new(e||o)(m.Rb(l.a),m.Rb(p.a),m.Rb(c.a))},o.\u0275cmp=m.Lb({type:o,selectors:[["app-request-qr-payment"]],features:[m.Cb],decls:2,vars:3,consts:[[3,"options","id"],["step1","",3,"id",4,"psStep"],["step1","",3,"id"],["id","qrCode_details_panel",3,"options"],["id","'transferFrom'+ id",3,"options"],["id","charges",3,"options"],["id","'purpose' + id",3,"options"],["id","qrCode_charges_panel",3,"options"],["id","exchange",3,"options"],["id","chargesAccount",3,"options","onAccountChange"]],template:function(o,e){1&o&&(m.Xb(0,"ps-template-stepper",0),m.Pc(1,N,8,8,"ps-form-step",1),m.Wb()),2&o&&(m.pc("options",e.stepperOptions)("id",e.stepperOptions.stepperName),m.Fb(1),m.pc("psStep","step1"))},directives:[h.a,O.a,f.a,d.a,y.a,b.a,A.a,g.a],styles:[""]}),o})()},VEWP:function(o,e,t){"use strict";t.d(e,"a",function(){return d});var s=t("mrSG"),n=t("fXoL"),i=t("4lGw"),c=t("V0Fi"),p=t("ZyuK"),r=t("ZF3V"),a=t("EIUR"),l=t("DFXC"),u=t("zngb"),m=t("Q0Ba"),h=t("Isd1"),O=t("L0og");const f=["complexLookupComponentObj"];let d=(()=>{class o extends r.a{constructor(o,e,t,s){super(o,e),this.commonService=o,this.omniPull=t,this.accountsService=s,this.options={fromTo:"",requestObject:null},this.complexLookupOptions={requestObject:null,notFoundMessage:"no_valid_account_found_key",multiple:!!this.options.multiple&&this.options.multiple},this.onAccountChange=new n.o,this.onAccountDeleted=new n.o,this.labelValuesMap=new Map,this.psCurrency=new a.a,this.labelOptions={},this.allType=!1}ngOnInit(){this.loadAccounts(null),this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.title="title_key",this.complexLookupOptions.subTitle="sub_title_key",this.complexLookupOptions.labelsValueMap=this.labelValuesMap,this.allType=!!this.options.allType&&this.options.allType,this.commonProv.copyObject(this.complexLookupOptions,this.options,!1),this.complexLookupOptions.requestObject=this.options.requestObject}ngOnChanges(o){this.complexLookupOptions.labelKey=this.options.labelKey,this.complexLookupOptions.placeHolder=this.options.placeHolder}loadAccounts(o){return Object(s.b)(this,void 0,void 0,function*(){if(null!=o&&(this.options=o),this.options.listOfAccounts=[],void 0===this.options.fromTo||""===this.options.fromTo)return void this.logger.error("lookup_from_to_missing_key");const e=this.commonService.session.getValueOf(u.a.USERINFO),t=this.prepareRequestData(e);this.returnAccountList(t)})}returnAccountList(o){return Object(s.b)(this,void 0,void 0,function*(){const e=this.commonProv.session.getValueOf(c.a.PERSONALIZATION_CO);this.complexLookupOptions.listOfOptions=void 0;const t=yield this.omniPull.returnAccounts(o).catch(o=>{this.complexLookupOptions.listOfOptions=[],this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",o)});if(t&&t.gridModel.length>0){if(this.allType){o.accountType="F",o.permittedGls="F";const e=yield this.omniPull.returnAccounts(o).catch(o=>{this.logger.error("Error: While fetching accounts in PsComplexOwnAccountComponent :",o)});e&&e.gridModel.length>0&&(t.gridModel=[...t.gridModel,...e.gridModel])}if(this.options.listOfAccounts=t.gridModel,this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(o=>o.accountNumber!==this.options.accountNumber)),this.options.currency&&""!==this.options.currency&&(this.complexLookupOptions.listOfOptions=this.fetchAccountBasedOnCurrency(this.options.currency),this.options.accountNumber&&""!==this.options.accountNumber&&(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts.filter(o=>o.accountNumber!==this.options.accountNumber))),null!=this.options.accountNumber&&""!==this.options.accountNumber||(this.complexLookupOptions.listOfOptions=this.options.listOfAccounts),this.complexLookupOptions.listOfOptions=this.populateCustomAccounts(this.complexLookupOptions.listOfOptions),this.complexLookupOptions.listOfOptions.map((o,e)=>o.rowIndex=e),this.allAccounts=Object.assign([],this.complexLookupOptions.listOfOptions),null==this.complexLookupOptions.selectedItems&&(this.complexLookupOptions.selectedItems=[]),this.complexLookupOptions.multiple&&this.handleMultipleSelection(),!this.options.requestObject[this.options.fcName]&&(this.options.defaultByPersonalizedAcc=null==this.options.defaultByPersonalizedAcc||this.options.defaultByPersonalizedAcc,"from"===this.options.fromTo&&this.options.defaultByPersonalizedAcc)){let o="QR"===this.options.purpose?null==e?void 0:e.defaultQrPaymentAccKey:null==e?void 0:e.defaultTransferAccKey;this.complexLookupOptions.listOfOptions.map(e=>{e.personalizeKey&&e.personalizeKey===o&&(this.common.setValInsideNestedObj(this.options.fcName,e.lookupKey,this.options.requestObject),this.common.setValInsideNestedObj(this.options.fcName+"_lookupKey",e.lookupKey,this.options.requestObject))})}}else this.listOfAccounts=[],this.complexLookupOptions.listOfOptions=[]})}populateCustomAccounts(o){const e=[];for(const t of o){const o={briefNameEnglish:t.briefNameEnglish,cifShortNameEnglish:t.cifShortNameEnglish,accountNumber:t.accountNumber,balance:this.psCurrency.transform(null==t.balance?"0.0":t.balance,t.currencyDecimalPoints)+" "+(t.currencyBriefName||t.currencyBriefNameEnglish),availableBalance:this.psCurrency.transform(null==t.availableBalance?"0.0":t.availableBalance,t.currencyDecimalPoints)+" "+(t.currencyBriefName||t.currencyBriefNameEnglish),currencyBriefName:t.currencyBriefName||t.currencyBriefNameEnglish,currencyBriefNameEnglish:t.currencyBriefNameEnglish,currency:t.currency,accountTypeDesc:t.accountTypeDesc,additionalRef:t.additionalRef,ibanAccNo:t.ibanAccNo,accGl:t.accGl,serialNo:t.serialNo,branch:t.branch,cif:t.cif,formattedAccount:this.accountsService.returnFormattedAccount(t).formattedAccount,personalizeKey:t.personalizeKey,nickName:t.nickName,briefName:t.briefName,lookupKey:t.additionalRef,branchDescription:t.branchDescription?t.branchDescription:"",generalLedgerBriefNameEng:t.generalLedgerBriefNameEng?t.generalLedgerBriefNameEng:"",previewProperty:"accountNumber",status:t.statusDescription,statusCode:t.status,accountFormat:this.accountsService.returnFormattedAccount(t).accountFormat};this.options.multiple&&(o.excludeType=t.excludeType),e.push(o)}return e}prepareRequestData(o){let e={};if(o&&o.omniUserVO&&(e={userCifNo:o.omniUserVO.CIF_NO,type:"A"}),null!=this.options.queryParams&&void 0!==this.options.queryParams&&""!==this.options.queryParams&&(e={commonParametersList:this.options.queryParams}),null!=this.options.accountType&&void 0!==this.options.accountType&&""!==this.options.accountType&&(e.accountType=this.options.accountType),null!=this.options.glTypes&&void 0!==this.options.glTypes&&""!==this.options.glTypes&&(e.permittedGls=this.options.glTypes),null!=this.options.fromTo&&""!==this.options.fromTo&&(e.fromTo=this.options.fromTo),null!=this.options.endUserId&&""!==this.options.endUserId&&(e.endUserId=this.options.endUserId),null!=this.options.fromCurrency?e.fromCurrency=this.options.fromCurrency:null!=this.options.toCurrency&&(e.toCurrency=this.options.toCurrency),null!=this.options.accountAllowedCurrencies&&void 0!==this.options.accountAllowedCurrencies)if("string"==typeof this.options.accountAllowedCurrencies)e.accountAllowedCurrencies=this.options.accountAllowedCurrencies;else{let o="";for(const e in this.options.accountAllowedCurrencies)o+=this.options.accountAllowedCurrencies[e]+",";o=o.slice(0,o.lastIndexOf(",")),e.accountAllowedCurrencies=o}if(null!=this.options.accountAllowedTypes&&void 0!==this.options.accountAllowedTypes)if("string"==typeof this.options.accountAllowedTypes)e.accountAllowedTypes=this.options.accountAllowedTypes;else{let o="";for(const e in this.options.accountAllowedTypes)o+=this.options.accountAllowedTypes[e]+",";o=o.slice(0,o.lastIndexOf(",")),e.accountAllowedTypes=o}return e}fetchAccountBasedOnCurrency(o){return this.options.listOfAccounts}onChange(o){this.logger.log(o)}populateOwnAccountMap(){let o={},e={},t={};o={key:"accountNumber",value:"--- --- --- ---",isEdit:!1},e={key:"currentBalance",value:"0.0",isEdit:!1},t={key:"availableBalance",value:"0.0",isEdit:!1},this.labelValuesMap.set("account_key",o),this.labelValuesMap.set("balance_key",e),this.labelValuesMap.set("available_balance_key",t)}onChangeItem(o){this.onAccountChange.emit(o)}onDeleteItem(o){o&&this.onAccountDeleted.emit(o)}handleMultipleSelection(){const o=this.options.setAllAccountsAsSelecetd?this.complexLookupOptions.listOfOptions:this.options.requestObject[this.options.fcName]?this.complexLookupOptions.listOfOptions.filter(o=>this.options.requestObject[this.options.fcName].some(e=>e.accountNumber==o.accountNumber)):[];this.complexLookupOptions.selectedItems=o.filter(o=>this.options.setAllAccountsAsSelecetd&&(!o.excludeType||!(o.excludeType.includes(c.a.GENERAL_ACCOUNT_EXCLUDE_TYPE)||o.excludeType.includes(c.a.TERM_ACCOUNT_EXCLUDE_TYPE)))||!this.options.setAllAccountsAsSelecetd).map(o=>Object.assign(Object.assign({item:o[o.previewProperty]},o),{itemLookup:o.lookupKey})),this.complexLookupOptions.selectedItems.length>0&&this.complexLookupComponentObj.setSelectedItems(this.complexLookupOptions.selectedItems)}removeAccount(o){o&&void 0!==this.allAccounts&&(this.complexLookupOptions.listOfOptions=this.allAccounts?this.allAccounts.filter(e=>o.accountNumber!=e.accountNumber):[])}reset(){this.complexLookupComponentObj.resetLookUp()}refreshAcounts(o){this.complexLookupOptions.listOfOptions=Object.assign([],this.allAccounts),this.removeAccount(o)}}return o.\u0275fac=function(e){return new(e||o)(n.Rb(m.a),n.Rb(l.a),n.Rb(p.a),n.Rb(i.a))},o.\u0275cmp=n.Lb({type:o,selectors:[["ps-lookup-own-accounts"]],viewQuery:function(o,e){if(1&o&&n.Wc(f,1),2&o){let o;n.Bc(o=n.gc())&&(e.complexLookupComponentObj=o.first)}},inputs:{options:"options"},outputs:{onAccountChange:"onAccountChange",onAccountDeleted:"onAccountDeleted"},features:[n.Cb,n.Db],decls:3,vars:2,consts:[[1,"ps-complex-own-account"],[3,"id","options","changeItem","onDeleteItem"],["complexLookupComponentObj",""]],template:function(o,e){1&o&&(n.Xb(0,"ps-container-complex",0),n.Xb(1,"ps-complex-lookup",1,2),n.fc("changeItem",function(o){return e.onChangeItem(o)})("onDeleteItem",function(o){return e.onDeleteItem(o)}),n.Wb(),n.Wb()),2&o&&(n.Fb(1),n.pc("id",e.id)("options",e.complexLookupOptions))},directives:[h.a,O.a],styles:[""]}),o})()}}]);